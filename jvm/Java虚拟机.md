# ä¸€ã€JVMçš„ç»„æˆ

![img](/Users/jack/Desktop/md/images/01.jpg)

- **ç±»åŠ è½½å™¨**ï¼Œåœ¨ JVM å¯åŠ¨æ—¶æˆ–è€…ç±»è¿è¡Œæ—¶å°†éœ€è¦çš„ class åŠ è½½åˆ° JVM ä¸­ã€‚
- **å†…å­˜åŒº**ï¼Œå°†å†…å­˜åˆ’åˆ†æˆè‹¥å¹²ä¸ªåŒºä»¥æ¨¡æ‹Ÿå®é™…æœºå™¨ä¸Šçš„å­˜å‚¨ã€è®°å½•å’Œè°ƒåº¦åŠŸèƒ½æ¨¡å—ï¼Œå¦‚å®é™…æœºå™¨ä¸Šçš„å„ç§åŠŸèƒ½çš„å¯„å­˜å™¨æˆ–è€… PC æŒ‡é’ˆçš„è®°å½•å™¨ç­‰ã€‚

- **æ‰§è¡Œå¼•æ“**ï¼Œæ‰§è¡Œå¼•æ“çš„ä»»åŠ¡æ˜¯è´Ÿè´£æ‰§è¡Œ class æ–‡ä»¶ä¸­åŒ…å«çš„å­—èŠ‚ç æŒ‡ä»¤ï¼Œç›¸å½“äºå®é™…æœºå™¨ä¸Šçš„ CPU ã€‚
- **æœ¬åœ°æ–¹æ³•è°ƒç”¨**ï¼Œè°ƒç”¨ C æˆ– C++ å®ç°çš„æœ¬åœ°æ–¹æ³•çš„ä»£ç è¿”å›ç»“æœã€‚

# äºŒã€Java å†…å­˜å †å’Œæ ˆåŒºåˆ«

- **æ ˆå†…å­˜ç”¨æ¥å­˜å‚¨åŸºæœ¬ç±»å‹çš„å˜é‡å’Œå¯¹è±¡çš„å¼•ç”¨å˜é‡ï¼›å †å†…å­˜ç”¨æ¥å­˜å‚¨Javaä¸­çš„å¯¹è±¡ï¼Œæ— è®ºæ˜¯æˆå‘˜å˜é‡ï¼Œå±€éƒ¨å˜é‡ï¼Œè¿˜æ˜¯ç±»å˜é‡ï¼Œå®ƒä»¬æŒ‡å‘çš„å¯¹è±¡éƒ½å­˜å‚¨åœ¨å †å†…å­˜ä¸­ã€‚**
- æ ˆå†…å­˜å½’å±äºå•ä¸ªçº¿ç¨‹ï¼Œ==æ¯ä¸ªçº¿ç¨‹éƒ½ä¼šæœ‰ä¸€ä¸ªæ ˆå†…å­˜==ï¼Œå…¶å­˜å‚¨çš„å˜é‡åªèƒ½åœ¨å…¶æ‰€å±çº¿ç¨‹ä¸­å¯è§ï¼Œå³æ ˆå†…å­˜å¯ä»¥ç†è§£æˆçº¿ç¨‹çš„ç§æœ‰å†…å­˜ï¼›==å †å†…å­˜ä¸­çš„å¯¹è±¡å¯¹æ‰€æœ‰çº¿ç¨‹å¯è§==ã€‚å †å†…å­˜ä¸­çš„å¯¹è±¡å¯ä»¥è¢«æ‰€æœ‰çº¿ç¨‹è®¿é—®ã€‚
- **å¦‚æœæ ˆå†…å­˜æ²¡æœ‰å¯ç”¨çš„ç©ºé—´å­˜å‚¨æ–¹æ³•è°ƒç”¨å’Œå±€éƒ¨å˜é‡ï¼ŒJVM ä¼šæŠ›å‡º `java.lang.StackOverFlowError` é”™è¯¯ï¼›å¦‚æœæ˜¯å †å†…å­˜æ²¡æœ‰å¯ç”¨çš„ç©ºé—´å­˜å‚¨ç”Ÿæˆçš„å¯¹è±¡ï¼ŒJVM ä¼šæŠ›å‡º `java.lang.OutOfMemoryError` é”™è¯¯ã€‚**
- æ ˆçš„å†…å­˜è¦è¿œè¿œå°äºå †å†…å­˜ï¼Œå¦‚æœä½ ä½¿ç”¨é€’å½’çš„è¯ï¼Œé‚£ä¹ˆä½ çš„æ ˆå¾ˆå¿«å°±ä¼šå……æ»¡ã€‚`-Xss` é€‰é¡¹è®¾ç½®æ ˆå†…å­˜çš„å¤§å°ï¼Œ`-Xms` é€‰é¡¹å¯ä»¥è®¾ç½®å †çš„å¼€å§‹æ—¶çš„å¤§å°ã€‚

å³ï¼š

> JVM ä¸­å †å’Œæ ˆå±äºä¸åŒçš„å†…å­˜åŒºåŸŸï¼Œä½¿ç”¨ç›®çš„ä¹Ÿä¸åŒã€‚æ ˆå¸¸ç”¨äºä¿å­˜æ–¹æ³•å¸§å’Œå±€éƒ¨å˜é‡ï¼Œè€Œå¯¹è±¡æ€»æ˜¯åœ¨å †ä¸Šåˆ†é…ã€‚æ ˆé€šå¸¸éƒ½æ¯”å †å°ï¼Œä¹Ÿä¸ä¼šåœ¨å¤šä¸ªçº¿ç¨‹ä¹‹é—´å…±äº«ï¼Œè€Œå †è¢«æ•´ä¸ª JVM çš„æ‰€æœ‰çº¿ç¨‹å…±äº«ã€‚

![img](/Users/jack/Desktop/md/images/03.png)

# ä¸‰ã€JAVA å¯¹è±¡åˆ›å»ºçš„è¿‡ç¨‹

JAVA å¯¹è±¡åˆ›å»ºçš„è¿‡ç¨‹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š![JAVA å¯¹è±¡åˆ›å»ºçš„è¿‡ç¨‹](/Users/jack/Desktop/md/images/06-20190404222153737.png)

- **Java ä¸­å¯¹è±¡çš„åˆ›å»ºå°±æ˜¯åœ¨å †ä¸Šåˆ†é…å†…å­˜ç©ºé—´çš„è¿‡ç¨‹ï¼Œæ­¤å¤„è¯´çš„å¯¹è±¡åˆ›å»ºä»…é™äº new å…³é”®å­—åˆ›å»ºçš„æ™®é€š Java å¯¹è±¡ï¼Œä¸åŒ…æ‹¬æ•°ç»„å¯¹è±¡çš„åˆ›å»ºã€‚**

## 1ï¼‰æ£€æµ‹ç±»æ˜¯å¦è¢«åŠ è½½

â€‹	å½“è™šæ‹Ÿæœºé‡åˆ° `new` æŒ‡ä»¤æ—¶ï¼Œ==é¦–å…ˆå…ˆå»æ£€æŸ¥è¿™ä¸ªæŒ‡ä»¤çš„å‚æ•°æ˜¯å¦èƒ½åœ¨å¸¸é‡æ± ä¸­**å®šä½åˆ°ä¸€ä¸ªç±»çš„ç¬¦å·å¼•ç”¨**ï¼Œå¹¶ä¸”æ£€æŸ¥è¿™ä¸ªç¬¦å·å¼•ç”¨ä»£è¡¨çš„ç±»æ˜¯å¦å·²è¢«åŠ è½½ã€è§£æå’Œåˆå§‹åŒ–è¿‡ã€‚==å¦‚æœæ²¡æœ‰ï¼Œå°±æ‰§è¡Œç±»åŠ è½½è¿‡ç¨‹ã€‚

## 2ï¼‰ä¸ºå¯¹è±¡åˆ†é…å†…å­˜

â€‹	ç±»åŠ è½½å®Œæˆä»¥åï¼Œè™šæ‹Ÿæœºå°±å¼€å§‹ä¸ºå¯¹è±¡åˆ†é…å†…å­˜ï¼Œæ­¤æ—¶æ‰€éœ€å†…å­˜çš„å¤§å°å°±å·²ç»ç¡®å®šäº†ã€‚åªéœ€è¦åœ¨å †ä¸Šåˆ†é…æ‰€éœ€è¦çš„å†…å­˜å³å¯ã€‚

**å…·ä½“çš„åˆ†é…å†…å­˜æœ‰ä¸¤ç§æƒ…å†µï¼šç¬¬ä¸€ç§æƒ…å†µæ˜¯å†…å­˜ç©ºé—´ç»å¯¹è§„æ•´ï¼Œç¬¬äºŒç§æƒ…å†µæ˜¯å†…å­˜ç©ºé—´æ˜¯ä¸è¿ç»­çš„ã€‚**

- å¯¹äºå†…å­˜ç»å¯¹è§„æ•´çš„æƒ…å†µç›¸å¯¹ç®€å•ä¸€äº›ï¼Œè™šæ‹Ÿæœºåªéœ€è¦åœ¨è¢«å ç”¨çš„å†…å­˜å’Œå¯ç”¨ç©ºé—´ä¹‹é—´ç§»åŠ¨æŒ‡é’ˆå³å¯ï¼Œè¿™ç§æ–¹å¼è¢«ç§°ä¸ºâ€œ**æŒ‡é’ˆç¢°æ’**â€ã€‚
- å¯¹äºå†…å­˜ä¸è§„æ•´çš„æƒ…å†µç¨å¾®å¤æ‚ä¸€ç‚¹ï¼Œè¿™æ—¶å€™è™šæ‹Ÿæœºéœ€è¦ç»´æŠ¤ä¸€ä¸ªåˆ—è¡¨ï¼Œæ¥è®°å½•å“ªäº›å†…å­˜æ˜¯å¯ç”¨çš„ã€‚åˆ†é…å†…å­˜çš„æ—¶å€™éœ€è¦æ‰¾åˆ°ä¸€ä¸ªå¯ç”¨çš„å†…å­˜ç©ºé—´ï¼Œç„¶ååœ¨åˆ—è¡¨ä¸Šè®°å½•ä¸‹å·²è¢«åˆ†é…ï¼Œè¿™ç§æ–¹å¼æˆä¸ºâ€œ**ç©ºé—²åˆ—è¡¨**â€ã€‚

![img](/Users/jack/Desktop/md/images/68747470733a2f2f757365722d676f6c642d63646e2e786974752e696f2f323031382f382f32322f313635363165353961343061326333643f773d3134323626683d33333326663d706e6726733d3236333436.jpg)

**å¤šçº¿ç¨‹å¹¶å‘æ—¶ä¼šå‡ºç°æ­£åœ¨ç»™å¯¹è±¡ A åˆ†é…å†…å­˜ï¼Œè¿˜æ²¡æ¥å¾—åŠä¿®æ”¹æŒ‡é’ˆï¼Œå¯¹è±¡ B åˆç”¨è¿™ä¸ªæŒ‡é’ˆåˆ†é…å†…å­˜ï¼Œè¿™æ ·å°±å‡ºç°é—®é¢˜äº†ã€‚è§£å†³è¿™ç§é—®é¢˜æœ‰ä¸¤ç§æ–¹æ¡ˆï¼š**

- ç¬¬ä¸€ç§ï¼Œæ˜¯é‡‡ç”¨åŒæ­¥çš„åŠæ³•ï¼Œä½¿ç”¨ CAS æ¥ä¿è¯æ“ä½œçš„åŸå­æ€§ã€‚
- å¦ä¸€ç§ï¼Œ**æ˜¯æ¯ä¸ªçº¿ç¨‹åˆ†é…å†…å­˜éƒ½åœ¨è‡ªå·±çš„ç©ºé—´å†…è¿›è¡Œï¼Œå³æ˜¯æ¯ä¸ªçº¿ç¨‹éƒ½åœ¨å †ä¸­é¢„å…ˆåˆ†é…ä¸€å°å—å†…å­˜ï¼Œç§°ä¸ºæœ¬åœ°çº¿ç¨‹åˆ†é…ç¼“å†²ï¼ˆThread Local Allocation Buffer, TLABï¼‰ï¼Œåˆ†é…å†…å­˜çš„æ—¶å€™å†TLABä¸Šåˆ†é…ï¼Œäº’ä¸å¹²æ‰°ã€‚å¯ä»¥é€šè¿‡ `-XX:+/-UseTLAB` å‚æ•°å†³å®šã€‚**

## 3ï¼‰ä¸ºåˆ†é…çš„å†…å­˜ç©ºé—´åˆå§‹åŒ–é›¶å€¼

â€‹	å¯¹è±¡çš„å†…å­˜åˆ†é…å®Œæˆåï¼Œè¿˜éœ€è¦å°†å¯¹è±¡çš„å†…å­˜ç©ºé—´éƒ½åˆå§‹åŒ–ä¸ºé›¶å€¼ï¼Œè¿™æ ·èƒ½ä¿è¯å¯¹è±¡å³ä½¿æ²¡æœ‰èµ‹åˆå€¼ï¼Œä¹Ÿå¯ä»¥ç›´æ¥ä½¿ç”¨ã€‚

## 4ï¼‰å¯¹å¯¹è±¡è¿›è¡Œå…¶ä»–è®¾ç½®

â€‹	**åˆ†é…å®Œå†…å­˜ç©ºé—´ï¼Œåˆå§‹åŒ–é›¶å€¼ä¹‹åï¼Œè™šæ‹Ÿæœºè¿˜éœ€è¦å¯¹å¯¹è±¡è¿›è¡Œå…¶ä»–å¿…è¦çš„è®¾ç½®ï¼Œè®¾ç½®çš„åœ°æ–¹éƒ½åœ¨å¯¹è±¡å¤´ä¸­ï¼ŒåŒ…æ‹¬è¿™ä¸ªå¯¹è±¡æ‰€å±çš„ç±»ï¼Œç±»çš„å…ƒæ•°æ®ä¿¡æ¯ï¼Œå¯¹è±¡çš„ hashcode ï¼ŒGC åˆ†ä»£å¹´é¾„ç­‰ä¿¡æ¯ã€‚**

## 5ï¼‰æ‰§è¡Œ init æ–¹æ³•

â€‹	æ‰§è¡Œå®Œä¸Šé¢çš„æ­¥éª¤ä¹‹åï¼Œåœ¨è™šæ‹Ÿæœºé‡Œè¿™ä¸ªå¯¹è±¡å°±ç®—åˆ›å»ºæˆåŠŸäº†ï¼Œä½†æ˜¯å¯¹äº Java ç¨‹åºæ¥è¯´è¿˜éœ€è¦æ‰§è¡Œ init æ–¹æ³•æ‰ç®—çœŸæ­£çš„åˆ›å»ºå®Œæˆï¼Œå› ä¸ºè¿™ä¸ªæ—¶å€™å¯¹è±¡åªæ˜¯è¢«åˆå§‹åŒ–é›¶å€¼äº†ï¼Œè¿˜æ²¡æœ‰çœŸæ­£çš„å»æ ¹æ®ç¨‹åºä¸­çš„ä»£ç åˆ†é…åˆå§‹å€¼ï¼Œ**è°ƒç”¨äº† init æ–¹æ³•ä¹‹åï¼Œè¿™ä¸ªå¯¹è±¡æ‰çœŸæ­£èƒ½ä½¿ç”¨ã€‚**

åˆ°æ­¤ä¸ºæ­¢ä¸€ä¸ªå¯¹è±¡å°±äº§ç”Ÿäº†ï¼Œè¿™å°±æ˜¯ new å…³é”®å­—åˆ›å»ºå¯¹è±¡çš„è¿‡ç¨‹ã€‚è¿‡ç¨‹å¦‚ä¸‹ï¼š

![JAVA å¯¹è±¡åˆ›å»ºçš„è¿‡ç¨‹](/Users/jack/Desktop/md/images/07-20190404222153727.png)

> å¦å¤–ï¼Œè¿™ä¸ªé—®é¢˜ï¼Œé¢è¯•å®˜å¯èƒ½å¼•ç”³æˆ â€œ`A a = new A()` ç»å†è¿‡ä»€ä¹ˆè¿‡ç¨‹â€çš„é—®é¢˜ã€‚

# å››ã€å¯¹è±¡çš„å†…å­˜å¸ƒå±€

å¯¹è±¡çš„å†…å­˜å¸ƒå±€åŒ…æ‹¬ä¸‰ä¸ªéƒ¨åˆ†ï¼š

- å¯¹è±¡å¤´ï¼šå¯¹è±¡å¤´åŒ…æ‹¬ä¸¤éƒ¨åˆ†ä¿¡æ¯ã€‚
  - ç¬¬ä¸€éƒ¨åˆ†ï¼Œæ˜¯å­˜å‚¨å¯¹è±¡è‡ªèº«çš„è¿è¡Œæ—¶æ•°æ®ï¼Œå¦‚å“ˆå¸Œç ï¼ŒGC åˆ†ä»£å¹´é¾„ï¼Œé”çŠ¶æ€æ ‡å¿—ï¼Œçº¿ç¨‹æŒæœ‰çš„é”ç­‰ç­‰ã€‚
  - ç¬¬äºŒéƒ¨åˆ†ï¼Œæ˜¯ç±»å‹æŒ‡é’ˆï¼Œå³å¯¹è±¡æŒ‡å‘ç±»å…ƒæ•°æ®çš„æŒ‡é’ˆã€‚
- å®ä¾‹æ•°æ®ï¼šå°±æ˜¯æ•°æ®ã€‚
- å¯¹é½å¡«å……ï¼šä¸æ˜¯å¿…ç„¶çš„å­˜åœ¨ï¼Œå°±æ˜¯ä¸ºäº†å¯¹é½ã€‚

# äº”ã€å¯¹è±¡çš„è®¿é—®å®šä½

å¯¹è±¡çš„è®¿é—®å®šä½æœ‰ä¸¤ç§ï¼š

- **å¥æŸ„å®šä½**ï¼šJava å †ä¼šç”»å‡ºä¸€å—å†…å­˜æ¥ä½œä¸ºå¥æŸ„æ± ï¼Œreference ä¸­å­˜å‚¨çš„å°±æ˜¯å¯¹è±¡çš„å¥æŸ„åœ°å€ï¼Œè€Œå¥æŸ„ä¸­åŒ…å«äº†å¯¹è±¡å®ä¾‹æ•°æ®ä¸å¯¹è±¡ç±»å‹æ•°æ®å„è‡ªçš„å…·ä½“åœ°å€ä¿¡æ¯ã€‚![å¥æŸ„å®šä½](/Users/jack/Desktop/md/images/04.png)
- **ç›´æ¥æŒ‡é’ˆ**è®¿é—®ï¼šJava å †å¯¹è±¡çš„ä¸å±…ä¸­å°±å¿…é¡»è€ƒè™‘å¦‚ä½•æ”¾ç½®è®¿é—®ç±»å‹æ•°æ®çš„ç›¸å…³ä¿¡æ¯ï¼Œè€Œ reference ä¸­å­˜å‚¨çš„ç›´æ¥å°±æ˜¯å¯¹è±¡åœ°å€ã€‚ ![ç›´æ¥æŒ‡é’ˆè®¿é—®](/Users/jack/Desktop/md/images/05.png)

## å¥æŸ„å®šä½å’Œç›´æ¥æŒ‡é’ˆè®¿é—®çš„åŒºåˆ«

è¿™ä¸¤ç§å¯¹è±¡è®¿é—®æ–¹å¼å„æœ‰ä¼˜åŠ¿ã€‚

- ä½¿ç”¨å¥æŸ„æ¥è®¿é—®çš„æœ€å¤§å¥½å¤„ï¼Œå°±æ˜¯ reference ä¸­å­˜å‚¨çš„æ˜¯ç¨³å®šçš„å¥æŸ„åœ°å€ï¼Œåœ¨å¯¹è±¡è¢«ç§»åŠ¨ï¼ˆåƒåœ¾æ”¶é›†æ—¶ç§»åŠ¨å¯¹è±¡æ˜¯éå¸¸æ™®éçš„è¡Œä¸ºï¼‰æ—¶åªä¼šæ”¹å˜å¥æŸ„ä¸­çš„å®ä¾‹æ•°æ®æŒ‡é’ˆï¼Œè€Œ reference æœ¬èº«ä¸éœ€è¦ä¿®æ”¹ã€‚
- ä½¿ç”¨ç›´æ¥æŒ‡é’ˆè®¿é—®æ–¹å¼çš„æœ€å¤§å¥½å¤„å°±æ˜¯é€Ÿåº¦æ›´å¿«ï¼Œå®ƒèŠ‚çœäº†ä¸€æ¬¡æŒ‡é’ˆå®šä½çš„æ—¶é—´å¼€é”€ï¼Œç”±äºå¯¹è±¡çš„è®¿é—®åœ¨ Java ä¸­éå¸¸é¢‘ç¹ï¼Œå› æ­¤è¿™ç±»å¼€é”€ç§¯å°‘æˆå¤šåä¹Ÿæ˜¯ä¸€é¡¹éå¸¸å¯è§‚çš„æ‰§è¡Œæˆæœ¬ã€‚

â€‹	ç›®å‰ä¸»è¦è™šæ‹Ÿæœº Sun HotSpot æ˜¯ä½¿ç”¨ç¬¬äºŒç§æ–¹å¼è¿›è¡Œå¯¹è±¡è®¿é—®çš„ï¼Œä½†ä»æ•´ä¸ªè½¯ä»¶å¼€å‘çš„èŒƒå›´æ¥çœ‹ï¼Œå„ç§è¯­è¨€å’Œæ¡†æ¶ä½¿ç”¨å¥æŸ„æ¥è®¿é—®çš„æƒ…å†µä¹Ÿååˆ†å¸¸è§ã€‚

# å…­ã€ OutOfMemoryError å¼‚å¸¸

**åœ¨ Java è™šæ‹Ÿæœºä¸­è§„èŒƒçš„æè¿°ä¸­ï¼Œé™¤äº†ç¨‹åºè®¡æ•°å™¨å¤–ï¼Œè™šæ‹Ÿæœºå†…å­˜çš„å…¶å®ƒå‡ ä¸ªè¿è¡Œæ—¶åŒºåŸŸéƒ½æœ‰å‘ç”Ÿçš„ OutOfMemoryError(ç®€ç§°ä¸ºâ€œOOMâ€) å¼‚å¸¸çš„å¯èƒ½ã€‚**

- Java å †æº¢å‡º

- è™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆæº¢å‡º

- æ–¹æ³•åŒºå’Œè¿è¡Œæ—¶å¸¸é‡æ± æº¢å‡º

  > ä» JDK8 å¼€å§‹ï¼Œå°±å˜æˆå…ƒæ•°æ®åŒºçš„å†…å­˜æº¢å‡ºã€‚

- æœ¬æœºç›´æ¥å†…å­˜æº¢å‡º

## **1ï¼‰Java å †æº¢å‡º**

â€‹	Javaåº”ç”¨ç¨‹åºåœ¨å¯åŠ¨æ—¶ä¼šæŒ‡å®šæ‰€éœ€è¦çš„å†…å­˜å¤§å°ï¼Œå®ƒè¢«åˆ†å‰²æˆä¸¤ä¸ªä¸åŒçš„åŒºåŸŸï¼š`Heap spaceï¼ˆå †ç©ºé—´ï¼‰`å’Œ`Permgenï¼ˆæ°¸ä¹…ä»£ï¼‰`ï¼š
![img](/Users/jack/Desktop/md/images/auto-orient-20190405164553472.png)

â€‹	 è¿™ä¸¤ä¸ªåŒºåŸŸçš„å¤§å°å¯ä»¥åœ¨JVMï¼ˆJavaè™šæ‹Ÿæœºï¼‰==å¯åŠ¨æ—¶é€šè¿‡å‚æ•°-Xmxå’Œ-XX:MaxPermSize==è®¾ç½®ï¼Œå¦‚æœä½ æ²¡æœ‰æ˜¾å¼è®¾ç½®ï¼Œåˆ™å°†ä½¿ç”¨ç‰¹å®šå¹³å°çš„é»˜è®¤å€¼ã€‚

â€‹	å½“åº”ç”¨ç¨‹åºè¯•å›¾å‘å †ç©ºé—´æ·»åŠ æ›´å¤šçš„æ•°æ®ï¼Œä½†å †å´æ²¡æœ‰è¶³å¤Ÿçš„ç©ºé—´æ¥å®¹çº³è¿™äº›æ•°æ®æ—¶ï¼Œå°†ä¼šè§¦å‘`java.lang.OutOfMemoryError: Java heap space`å¼‚å¸¸ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼šå³ä½¿æœ‰è¶³å¤Ÿçš„ç‰©ç†å†…å­˜å¯ç”¨ï¼Œåªè¦è¾¾åˆ°å †ç©ºé—´è®¾ç½®çš„å¤§å°é™åˆ¶ï¼Œæ­¤å¼‚å¸¸ä»ç„¶ä¼šè¢«è§¦å‘ã€‚

â€‹	é‡ç°æ–¹å¼ï¼Œå‚è§ [ã€ŠJava å †æº¢å‡ºã€‹](https://blog.csdn.net/sells2012/article/details/18654915) æ–‡ç« ã€‚

å¦å¤–ï¼Œ**Java å †æº¢å‡ºçš„åŸå› ï¼Œæœ‰å¯èƒ½æ˜¯å†…å­˜æ³„éœ²ï¼Œå¯ä»¥ä½¿ç”¨ MAT è¿›è¡Œåˆ†æã€‚**

## **2ï¼‰è™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆæº¢å‡º**

â€‹	ç”±äºåœ¨ HotSpot è™šæ‹Ÿæœºä¸­å¹¶ä¸åŒºåˆ†è™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆï¼Œå› æ­¤ï¼Œå¯¹äº HotSpot æ¥è¯´ï¼Œè™½ç„¶ `-Xoss` å‚æ•°ï¼ˆè®¾ç½®æœ¬åœ°æ–¹æ³•æ ˆå¤§å°ï¼‰å­˜åœ¨ï¼Œä½†å®é™…ä¸Šæ˜¯æ— æ•ˆçš„ï¼Œæ ˆå®¹é‡åªç”± `-Xss`å‚æ•°è®¾å®šã€‚

å…³äºè™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆï¼Œåœ¨ Java è™šæ‹Ÿæœºè§„èŒƒä¸­æè¿°äº†ä¸¤ç§å¼‚å¸¸ï¼š

- å¦‚æœçº¿ç¨‹è¯·æ±‚çš„æ ˆæ·±åº¦å¤§äºè™šæ‹Ÿæœºæ‰€å…è®¸çš„æœ€å¤§æ·±åº¦ï¼Œå°†æŠ›å‡º StackOverflowError å¼‚å¸¸ã€‚

  > StackOverflowError ä¸å±äº OOM å¼‚å¸¸å“ˆã€‚

- å¦‚æœè™šæ‹Ÿæœºåœ¨æ‰©å±•æ ˆæ—¶æ— æ³•ç”³è¯·åˆ°è¶³å¤Ÿçš„å†…å­˜ç©ºé—´ï¼Œåˆ™æŠ›å‡º OutOfMemoryError å¼‚å¸¸ã€‚

é‡ç°æ–¹å¼ï¼Œå‚è§ [ã€ŠOutOfMemoryError å¼‚å¸¸ â€”â€” è™šæ‹Ÿæœºæ ˆå’Œæœ¬åœ°æ–¹æ³•æ ˆæº¢å‡ºã€‹](https://blog.csdn.net/en_joker/article/details/79727675) æ–‡ç« ã€‚

## **3ï¼‰è¿è¡Œæ—¶å¸¸é‡æ± æº¢å‡º**

â€‹	å› ä¸º JDK7 å°†å¸¸é‡æ± å’Œé™æ€å˜é‡æ”¾åˆ° Java å †é‡Œï¼Œæ‰€ä»¥æ— æ³•è§¦å‘è¿è¡Œæ—¶å¸¸é‡æ± æº¢å‡ºã€‚å¦‚æœæƒ³è¦è§¦å‘ï¼Œå¯ä»¥ä½¿ç”¨ JDK6 çš„ç‰ˆæœ¬ã€‚

é‡ç°æ–¹å¼ï¼Œå‚è§ [ã€ŠJVM å†…å­˜æº¢å‡º - æ–¹æ³•åŒºåŠè¿è¡Œæ—¶å¸¸é‡æ± æº¢å‡ºã€‹](https://www.niuhp.com/java/jvm-oom-pg.html) æ–‡ç« ã€‚

## **4ï¼‰æ–¹æ³•åŒºçš„å†…å­˜æº¢å‡º**

å› ä¸º JDK8 å°†æ–¹æ³•åŒºæº¢å‡ºï¼Œæ‰€ä»¥æ— æ³•è§¦å‘æ–¹æ³•åŒºçš„å†…å­˜æº¢å‡ºæº¢å‡ºã€‚å¦‚æœæƒ³è¦è§¦å‘ï¼Œå¯ä»¥ä½¿ç”¨ JDK7 çš„ç‰ˆæœ¬ã€‚

é‡ç°æ–¹å¼ï¼Œå‚è§ [ã€ŠJava æ–¹æ³•åŒºæº¢å‡ºã€‹](https://blog.csdn.net/tanga842428/article/details/52636836) æ–‡ç« ã€‚

## **5ï¼‰å…ƒæ•°æ®åŒºçš„å†…å­˜æº¢å‡º**

â€‹	å®é™…ä¸Šï¼Œæ–¹æ³•åŒºçš„å†…å­˜æº¢å‡ºåœ¨ JDK8 ä¸­ï¼Œå˜æˆäº†å…ƒæ•°æ®åŒºçš„å†…å­˜æº¢å‡ºã€‚æ‰€ä»¥ï¼Œé‡ç°æ–¹å¼ï¼Œè¿˜æ˜¯å‚è§ [ã€ŠJava æ–¹æ³•åŒºæº¢å‡ºã€‹](https://blog.csdn.net/tanga842428/article/details/52636836) æ–‡ç« ï¼Œåªæ˜¯è¯´ï¼Œéœ€è¦å¢åŠ  `-XX:MaxMetaspaceSize=10m` VM é…ç½®é¡¹ã€‚

## **6ï¼‰æœ¬æœºç›´æ¥å†…å­˜æº¢å‡º**

é‡ç°æ–¹å¼ï¼Œå‚è§ [ã€ŠJVM å†…å­˜æº¢å‡º â€”â€” ç›´æ¥å†…å­˜æº¢å‡ºã€‹](https://www.niuhp.com/java/jvm-oom-direct.html) æ–‡ç« ã€‚

------

å…·ä½“å¯ä»¥å‚ç…§ï¼Œ[ã€ŠJava å†…å­˜æº¢å‡º(OOM)å¼‚å¸¸å®Œå…¨æŒ‡å—ã€‹](https://www.jianshu.com/p/2fdee831ed03) ã€‚

### **å½“å‡ºç°äº†å†…å­˜æº¢å‡ºï¼Œå¦‚ä½•æ’é”™**

- 1ã€é¦–å…ˆï¼Œæ§åˆ¶å°æŸ¥çœ‹é”™è¯¯æ—¥å¿—ã€‚
- 2ã€ç„¶åï¼Œä½¿ç”¨ JDK è‡ªå¸¦çš„ jvisualvm å·¥å…·æŸ¥çœ‹ç³»ç»Ÿçš„å †æ ˆæ—¥å¿—ã€‚
- 3ã€å®šä½å‡ºå†…å­˜æº¢å‡ºçš„ç©ºé—´ï¼šå †ï¼Œæ ˆè¿˜æ˜¯æ°¸ä¹…ä»£ï¼ˆJDK8 ä»¥åä¸ä¼šå‡ºç°æ°¸ä¹…ä»£çš„å†…å­˜æº¢å‡ºï¼‰ã€‚
  - å¦‚æœæ˜¯å †å†…å­˜æº¢å‡ºï¼Œçœ‹æ˜¯å¦åˆ›å»ºäº†è¶…å¤§çš„å¯¹è±¡ã€‚
  - å¦‚æœæ˜¯æ ˆå†…å­˜æº¢å‡ºï¼Œçœ‹æ˜¯å¦åˆ›å»ºäº†è¶…å¤§çš„å¯¹è±¡ï¼Œæˆ–è€…äº§ç”Ÿäº†æ­»å¾ªç¯ã€‚

# ä¸ƒã€å†…å­˜æ³„æ¼

â€‹	ç†è®ºä¸Š Java å› ä¸ºæœ‰åƒåœ¾å›æ”¶æœºåˆ¶ï¼ˆGCï¼‰ä¸ä¼šå­˜åœ¨å†…å­˜æ³„éœ²é—®é¢˜ï¼ˆè¿™ä¹Ÿæ˜¯ Java è¢«å¹¿æ³›ä½¿ç”¨äºæœåŠ¡å™¨ç«¯ç¼–ç¨‹çš„ä¸€ä¸ªé‡è¦åŸå› ï¼‰ã€‚ç„¶è€Œåœ¨å®é™…å¼€å‘ä¸­ï¼Œå¯èƒ½ä¼šå­˜åœ¨**æ— ç”¨ä½†å¯è¾¾çš„å¯¹è±¡**ï¼Œè¿™äº›å¯¹è±¡ä¸èƒ½è¢« GC å›æ”¶ä¹Ÿä¼šå‘ç”Ÿå†…å­˜æ³„éœ²ã€‚ä¾‹å¦‚è¯´ï¼š

- Hibernate çš„ Sessionï¼ˆä¸€çº§ç¼“å­˜ï¼‰ä¸­çš„å¯¹è±¡å±äºæŒä¹…æ€ï¼Œåƒåœ¾å›æ”¶å™¨æ˜¯ä¸ä¼šå›æ”¶è¿™äº›å¯¹è±¡çš„ï¼Œç„¶è€Œè¿™äº›å¯¹è±¡ä¸­å¯èƒ½å­˜åœ¨æ— ç”¨çš„åƒåœ¾å¯¹è±¡ã€‚
- ä½¿ç”¨ Netty çš„å †å¤–çš„ ByteBuf å¯¹è±¡ï¼Œåœ¨ä½¿ç”¨å®Œåï¼Œå¹¶æœªå½’è¿˜ï¼Œå¯¼è‡´ä½¿ç”¨çš„ä¸€ç‚¹ä¸€ç‚¹åœ¨æ³„éœ²ã€‚

# å…«ã€åƒåœ¾æ”¶é›†å™¨ä¸å†…å­˜åˆ†é…ç­–ç•¥

## 1.åƒåœ¾å›æ”¶æœºåˆ¶

- Java ä¸­å¯¹è±¡æ˜¯é‡‡ç”¨ `new` æˆ–è€…åå°„çš„æ–¹æ³•åˆ›å»ºçš„ï¼Œè¿™äº›å¯¹è±¡çš„åˆ›å»ºéƒ½æ˜¯åœ¨å †(Heap)ä¸­åˆ†é…çš„ï¼Œ**æ‰€æœ‰å¯¹è±¡çš„å›æ”¶éƒ½æ˜¯ç”± Java è™šæ‹Ÿæœºé€šè¿‡åƒåœ¾å›æ”¶æœºåˆ¶å®Œæˆçš„ã€‚**GC ä¸ºäº†èƒ½å¤Ÿæ­£ç¡®é‡Šæ”¾å¯¹è±¡ï¼Œä¼šç›‘æ§æ¯ä¸ªå¯¹è±¡çš„è¿è¡ŒçŠ¶å†µï¼Œå¯¹ä»–ä»¬çš„ç”³è¯·ã€å¼•ç”¨ã€è¢«å¼•ç”¨ã€èµ‹å€¼ç­‰çŠ¶å†µè¿›è¡Œç›‘æ§ã€‚
- Java ç¨‹åºå‘˜ä¸ç”¨æ‹…å¿ƒå†…å­˜ç®¡ç†ï¼Œå› ä¸ºåƒåœ¾æ”¶é›†å™¨ä¼šè‡ªåŠ¨è¿›è¡Œç®¡ç†ã€‚
- å¯ä»¥è°ƒç”¨ä¸‹é¢çš„æ–¹æ³•ä¹‹ä¸€ï¼š`System.gc()` æˆ– `Runtime.getRuntime().gc()` ï¼Œ**ä½† JVM ä¹Ÿå¯ä»¥å±è”½æ‰æ˜¾ç¤ºçš„åƒåœ¾å›æ”¶è°ƒç”¨ã€‚**

### **1.1 ä¸ºä»€ä¹ˆä¸å»ºè®®åœ¨ç¨‹åºä¸­æ˜¾å¼çš„å£°æ˜ System.gc() ï¼Ÿ**

â€‹	å› ä¸ºæ˜¾å¼å£°æ˜æ˜¯åšå †å†…å­˜å…¨æ‰«æï¼Œä¹Ÿå°±æ˜¯ Full GC ï¼Œæ˜¯éœ€è¦åœæ­¢æ‰€æœ‰çš„æ´»åŠ¨çš„(Stop The World Collection)ï¼Œå¯¹åº”ç”¨å¾ˆå¤§å¯èƒ½å­˜åœ¨å½±å“ã€‚

å¦å¤–ï¼Œè°ƒç”¨ `System.gc()` æ–¹æ³•åï¼Œä¸ä¼šç«‹å³æ‰§è¡Œ Full GC ï¼Œè€Œæ˜¯è™šæ‹Ÿæœºè‡ªå·±å†³å®šçš„ã€‚

 **å¦‚æœä¸€ä¸ªå¯¹è±¡çš„å¼•ç”¨è¢«è®¾ç½®ä¸º null , GC ä¸ä¼šç«‹å³é‡Šæ”¾è¯¥å¯¹è±¡çš„å†…å­˜ï¼Œè¿™ä¸ªå¯¹è±¡å°†ä¼šåœ¨ä¸‹ä¸€æ¬¡ GC å¾ªç¯ä¸­è¢«å›æ”¶ã€‚**

### 1.2 **finalize() æ–¹æ³•**

`finallize()` æ–¹æ³•ï¼Œæ˜¯Objectç±»ä¸­çš„æ–¹æ³•ï¼Œ**ä¸»è¦æ˜¯åœ¨é‡Šæ”¾è¯¥å¯¹è±¡å†…å­˜å‰ç”± GC (åƒåœ¾å›æ”¶å™¨)è°ƒç”¨ã€‚**

- é€šå¸¸å»ºè®®åœ¨è¿™ä¸ªæ–¹æ³•ä¸­é‡Šæ”¾è¯¥å¯¹è±¡æŒæœ‰çš„èµ„æºï¼Œä¾‹å¦‚æŒæœ‰çš„å †å¤–å†…å­˜ã€å’Œè¿œç¨‹æœåŠ¡çš„é•¿è¿æ¥ã€‚
- ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œä¸å»ºè®®é‡å†™è¯¥æ–¹æ³•ã€‚
- å¯¹äºä¸€ä¸ªå¯¹è±¡ï¼Œè¯¥æ–¹æ³•æœ‰ä¸”ä»…ä¼šè¢«è°ƒç”¨ä¸€æ¬¡ã€‚

## 2.åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ˜¯å¦å·²ç»æ­»å»

æœ‰ä¸¤ç§æ–¹å¼ï¼š

1. å¼•ç”¨è®¡æ•°
2. å¯è¾¾æ€§åˆ†æ

### **1ï¼‰å¼•ç”¨è®¡æ•°**

â€‹	æ¯ä¸ªå¯¹è±¡æœ‰ä¸€ä¸ªå¼•ç”¨è®¡æ•°å±æ€§ï¼Œ**æ–°å¢ä¸€ä¸ªå¼•ç”¨æ—¶è®¡æ•°åŠ  1 ï¼Œå¼•ç”¨é‡Šæ”¾æ—¶è®¡æ•°å‡ 1 ï¼Œè®¡æ•°ä¸º 0 æ—¶å¯ä»¥å›æ”¶ã€‚**æ­¤æ–¹æ³•ç®€å•ï¼Œæ— æ³•è§£å†³å¯¹è±¡ç›¸äº’å¾ªç¯å¼•ç”¨çš„é—®é¢˜ã€‚ç›®å‰åœ¨ç”¨çš„æœ‰ Pythonã€ActionScript3 ç­‰è¯­è¨€ã€‚

### **2ï¼‰å¯è¾¾æ€§åˆ†æï¼ˆReachability Analysisï¼‰**

â€‹	ä» GC Roots å¼€å§‹å‘ä¸‹æœç´¢ï¼Œæœç´¢æ‰€èµ°è¿‡çš„è·¯å¾„ç§°ä¸ºå¼•ç”¨é“¾ã€‚å½“ä¸€ä¸ªå¯¹è±¡åˆ° GC Roots æ²¡æœ‰ä»»ä½•å¼•ç”¨é“¾ç›¸è¿æ—¶ï¼Œåˆ™è¯æ˜æ­¤å¯¹è±¡æ˜¯ä¸å¯ç”¨çš„ã€‚ä¸å¯è¾¾å¯¹è±¡ã€‚ç›®å‰åœ¨ç”¨çš„æœ‰ Javaã€C# ç­‰è¯­è¨€ã€‚

 **å¦‚æœ A å’Œ B å¯¹è±¡å¾ªç¯å¼•ç”¨ï¼Œæ˜¯å¦å¯ä»¥è¢« GCï¼Ÿ**

==å¯ä»¥ï¼Œå› ä¸º Java é‡‡ç”¨å¯è¾¾æ€§åˆ†æçš„åˆ¤æ–­æ–¹å¼==ã€‚

####  **åœ¨ Java è¯­è¨€é‡Œï¼Œå¯ä½œä¸º GC Roots çš„å¯¹è±¡æœ‰ï¼š**

1. è™šæ‹Ÿæœºæ ˆï¼ˆæ ˆå¸§ä¸­çš„æœ¬åœ°å˜é‡è¡¨ï¼‰ä¸­å¼•ç”¨çš„å¯¹è±¡ã€‚
2. æ–¹æ³•åŒºä¸­çš„ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡ã€‚
3. æ–¹æ³•åŒºä¸­å¸¸é‡å¼•ç”¨çš„å¯¹è±¡ã€‚
4. æœ¬åœ°æ–¹æ³•æ ˆä¸­ JNI(å³ä¸€èˆ¬è¯´çš„ Native æ–¹æ³•)ä¸­å¼•ç”¨çš„å¯¹è±¡ã€‚

**æ–¹æ³•åŒºå¯ä»¥è¢«å›æ”¶ï¼Œä½†æ˜¯ä»·å€¼å¾ˆä½ï¼Œä¸»è¦å›æ”¶åºŸå¼ƒçš„å¸¸é‡å’Œæ— ç”¨çš„ç±»ã€‚**

#### æ— ç”¨çš„ç±»éœ€è¦å®Œå…¨æ»¡è¶³å¦‚ä¸‹ä¸‰ä¸ªæ¡ä»¶ï¼š

1. è¯¥ç±»æ‰€æœ‰å®ä¾‹éƒ½è¢«å›æ”¶ï¼ˆJava å †ä¸­æ²¡æœ‰è¯¥ç±»çš„å¯¹è±¡ï¼‰ã€‚
2. åŠ è½½è¯¥ç±»çš„ ClassLoader å·²ç»è¢«å›æ”¶ã€‚
3. è¯¥ç±»å¯¹åº”çš„ `java.lang.Class` å¯¹è±¡æ²¡æœ‰åœ¨ä»»ä½•åœ°æ–¹è¢«å¼•ç”¨ï¼Œæ— æ³•åœ¨ä»»ä½•åœ°æ–¹åˆ©ç”¨åå°„è®¿é—®è¯¥ç±»ã€‚

## 3.Java å¯¹è±¡å¼•ç”¨ç±»å‹

Java ä¸€å…±æœ‰å››ç§å¼•ç”¨ç±»å‹ï¼š

- å¼ºå¼•ç”¨
- è½¯å¼•ç”¨ï¼ˆSoftReferenceï¼‰
- å¼±å¼•ç”¨ï¼ˆWeakReferenceï¼‰
- è™šå¼•ç”¨ï¼ˆPhantomReferenceï¼‰

### **1ï¼‰å¼ºå¼•ç”¨**

â€‹	ä»¥å‰æˆ‘ä»¬ä½¿ç”¨çš„å¤§éƒ¨åˆ†å¼•ç”¨å®é™…ä¸Šéƒ½æ˜¯å¼ºå¼•ç”¨ï¼Œè¿™æ˜¯ä½¿ç”¨æœ€æ™®éçš„å¼•ç”¨ã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡å…·æœ‰å¼ºå¼•ç”¨ï¼Œé‚£å°±ç±»ä¼¼äºå¿…ä¸å¯å°‘çš„ç”Ÿæ´»ç”¨å“ï¼Œåƒåœ¾å›æ”¶å™¨ç»ä¸ä¼šå›æ”¶å®ƒã€‚**å½“å†…å­˜ç©ºé—´ä¸è¶³ï¼ŒJava è™šæ‹Ÿæœºå®æ„¿æŠ›å‡º OutOfMemoryError é”™è¯¯ï¼Œä½¿ç¨‹åºå¼‚å¸¸ç»ˆæ­¢ï¼Œä¹Ÿä¸ä¼šé éšæ„å›æ”¶å…·æœ‰å¼ºå¼•ç”¨çš„å¯¹è±¡æ¥è§£å†³å†…å­˜ä¸è¶³é—®é¢˜ã€‚**

### **2ï¼‰è½¯å¼•ç”¨ï¼ˆSoftReferenceï¼‰**

â€‹	ÃŸå¦‚æœä¸€ä¸ªå¯¹è±¡åªå…·æœ‰è½¯å¼•ç”¨ï¼Œé‚£å°±ç±»ä¼¼äºå¯æœ‰å¯ç‰©çš„ç”Ÿæ´»ç”¨å“ã€‚**å¦‚æœå†…å­˜ç©ºé—´è¶³å¤Ÿï¼Œåƒåœ¾å›æ”¶å™¨å°±ä¸ä¼šå›æ”¶å®ƒï¼Œå¦‚æœå†…å­˜ç©ºé—´ä¸è¶³äº†ï¼Œå°±ä¼šå›æ”¶è¿™äº›å¯¹è±¡çš„å†…å­˜ã€‚åªè¦åƒåœ¾å›æ”¶å™¨æ²¡æœ‰å›æ”¶å®ƒï¼Œè¯¥å¯¹è±¡å°±å¯ä»¥è¢«ç¨‹åºä½¿ç”¨ã€‚è½¯å¼•ç”¨å¯ç”¨æ¥å®ç°å†…å­˜æ•æ„Ÿçš„é«˜é€Ÿç¼“å­˜ã€‚**

â€‹	è½¯å¼•ç”¨å¯ä»¥å’Œä¸€ä¸ªå¼•ç”¨é˜Ÿåˆ—ï¼ˆReferenceQueueï¼‰è”åˆä½¿ç”¨ï¼Œå¦‚æœè½¯å¼•ç”¨æ‰€å¼•ç”¨çš„å¯¹è±¡è¢«åƒåœ¾å›æ”¶ï¼ŒJAVA è™šæ‹Ÿæœºå°±ä¼šæŠŠè¿™ä¸ªè½¯å¼•ç”¨åŠ å…¥åˆ°ä¸ä¹‹å…³è”çš„å¼•ç”¨é˜Ÿåˆ—ä¸­ã€‚

ä½¿ç”¨ç¤ºä¾‹ï¼Œè§ [ã€Šç²¾å°½ MyBatis æºç åˆ†æ â€”â€” ç¼“å­˜æ¨¡å—ã€‹](http://svip.iocoder.cn/MyBatis/cache-package/) çš„ [ã€Œ2.10 SoftCacheã€](http://svip.iocoder.cn/Java/VirtualMachine/Interview/#) å°èŠ‚ã€‚

### **3ï¼‰å¼±å¼•ç”¨ï¼ˆWeakReferenceï¼‰**

â€‹	å¦‚æœä¸€ä¸ªå¯¹è±¡åªå…·æœ‰å¼±å¼•ç”¨ï¼Œé‚£å°±ç±»ä¼¼äºå¯æœ‰å¯ç‰©çš„ç”Ÿæ´»ç”¨å“ã€‚==å¼±å¼•ç”¨ä¸è½¯å¼•ç”¨çš„åŒºåˆ«åœ¨äºï¼šåªå…·æœ‰å¼±å¼•ç”¨çš„å¯¹è±¡æ‹¥æœ‰æ›´çŸ­æš‚çš„ç”Ÿå‘½å‘¨æœŸ==ã€‚**åœ¨åƒåœ¾å›æ”¶å™¨çº¿ç¨‹æ‰«æå®ƒ æ‰€ç®¡è¾–çš„å†…å­˜åŒºåŸŸçš„è¿‡ç¨‹ä¸­ï¼Œä¸€æ—¦å‘ç°äº†åªå…·æœ‰å¼±å¼•ç”¨çš„å¯¹è±¡ï¼Œä¸ç®¡å½“å‰å†…å­˜ç©ºé—´è¶³å¤Ÿä¸å¦ï¼Œéƒ½ä¼šå›æ”¶å®ƒçš„å†…å­˜**ã€‚ä¸è¿‡ï¼Œç”±äºåƒåœ¾å›æ”¶å™¨æ˜¯ä¸€ä¸ªä¼˜å…ˆçº§å¾ˆä½çš„çº¿ç¨‹ï¼Œ å› æ­¤ä¸ä¸€å®šä¼šå¾ˆå¿«å‘ç°é‚£äº›åªå…·æœ‰å¼±å¼•ç”¨çš„å¯¹è±¡ã€‚

â€‹	å¼±å¼•ç”¨å¯ä»¥å’Œä¸€ä¸ªå¼•ç”¨é˜Ÿåˆ—ï¼ˆReferenceQueueï¼‰è”åˆä½¿ç”¨ï¼Œå¦‚æœå¼±å¼•ç”¨æ‰€å¼•ç”¨çš„å¯¹è±¡è¢«åƒåœ¾å›æ”¶ï¼ŒJavaè™šæ‹Ÿæœºå°±ä¼šæŠŠè¿™ä¸ªå¼±å¼•ç”¨åŠ å…¥åˆ°ä¸ä¹‹å…³è”çš„å¼•ç”¨é˜Ÿåˆ—ä¸­ã€‚

ä½¿ç”¨ç¤ºä¾‹ï¼Œè§

- [ã€Šç²¾å°½ MyBatis æºç åˆ†æ â€”â€” ç¼“å­˜æ¨¡å—ã€‹](http://svip.iocoder.cn/MyBatis/cache-package/) çš„ [ã€Œ2.9 WeakCacheã€](http://svip.iocoder.cn/Java/VirtualMachine/Interview/#) å°èŠ‚ã€‚
- [ã€Šç²¾å°½ Netty æºç è§£æ â€”â€” Buffer ä¹‹ ByteBufï¼ˆä¸‰ï¼‰å†…å­˜æ³„éœ²æ£€æµ‹ã€‹](http://svip.iocoder.cn/Netty/ByteBuf-1-3-ByteBuf-resource-leak-detector/) çš„ [ã€Œ4. ResourceLeakDetectorã€](http://svip.iocoder.cn/Java/VirtualMachine/Interview/#) å°èŠ‚ã€‚

### **4ï¼‰è™šå¼•ç”¨ï¼ˆPhantomReferenceï¼‰**

â€‹	â€œè™šå¼•ç”¨â€é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å½¢åŒè™šè®¾ï¼Œä¸å…¶ä»–å‡ ç§å¼•ç”¨éƒ½ä¸åŒï¼Œè™šå¼•ç”¨å¹¶ä¸ä¼šå†³å®šå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡ä»…æŒæœ‰è™šå¼•ç”¨ï¼Œé‚£ä¹ˆå®ƒå°±å’Œæ²¡æœ‰ä»»ä½•å¼•ç”¨ä¸€æ ·ï¼Œåœ¨ä»»ä½•æ—¶å€™éƒ½å¯èƒ½è¢«åƒåœ¾å›æ”¶ã€‚

â€‹	è™šå¼•ç”¨ä¸»è¦ç”¨æ¥è·Ÿè¸ªå¯¹è±¡è¢«åƒåœ¾å›æ”¶çš„æ´»åŠ¨ã€‚==è™šå¼•ç”¨ä¸è½¯å¼•ç”¨å’Œå¼±å¼•ç”¨çš„ä¸€ä¸ªåŒºåˆ«åœ¨äºï¼šè™šå¼•ç”¨å¿…é¡»å’Œå¼•ç”¨é˜Ÿåˆ—ï¼ˆReferenceQueueï¼‰è”åˆä½¿ç”¨ã€‚==**å½“åƒåœ¾å›æ”¶å™¨å‡†å¤‡å›æ”¶ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå¦‚æœå‘ç°å®ƒè¿˜æœ‰è™šå¼•ç”¨ï¼Œå°±ä¼šåœ¨å›æ”¶å¯¹è±¡çš„å†…å­˜ä¹‹å‰ï¼ŒæŠŠè¿™ä¸ªè™šå¼•ç”¨åŠ å…¥åˆ°ä¸ä¹‹å…³è”çš„å¼•ç”¨é˜Ÿåˆ—ä¸­ã€‚**ç¨‹åºå¯ä»¥é€šè¿‡åˆ¤æ–­å¼•ç”¨é˜Ÿåˆ—ä¸­æ˜¯å¦å·²ç»åŠ å…¥äº†è™šå¼•ç”¨ï¼Œæ¥äº†è§£è¢«å¼•ç”¨çš„å¯¹è±¡æ˜¯å¦å°†è¦è¢«åƒåœ¾å›æ”¶ã€‚ç¨‹åºå¦‚æœå‘ç°æŸä¸ªè™šå¼•ç”¨å·²ç»è¢«åŠ å…¥åˆ°å¼•ç”¨é˜Ÿåˆ—ï¼Œé‚£ä¹ˆå°±å¯ä»¥åœ¨æ‰€å¼•ç”¨çš„å¯¹è±¡çš„å†…å­˜è¢«å›æ”¶ä¹‹å‰é‡‡å–å¿…è¦çš„è¡ŒåŠ¨ã€‚

å‚ç…§ [ã€ŠJava ä¸­çš„å››ç§å¼•ç”¨ç±»å‹ã€‹](http://www.iocoder.cn/Fight/Four-reference-types-in-Java/?vip) æä¾›çš„ä»£ç ç¤ºä¾‹ã€‚

###  **WeakReference ä¸ SoftReferenceçš„åŒºåˆ«**

è™½ç„¶ WeakReference ä¸ SoftReference éƒ½æœ‰åˆ©äºæé«˜ GC å’Œ å†…å­˜çš„æ•ˆç‡ã€‚

- ä½†æ˜¯ WeakReference ä¸€æ—¦å¤±å»æœ€åä¸€ä¸ªå¼ºå¼•ç”¨ï¼Œå°±ä¼šè¢« GC å›æ”¶
- è€Œ SoftReference è™½ç„¶ä¸èƒ½é˜»æ­¢è¢«å›æ”¶ï¼Œä½†æ˜¯å¯ä»¥å»¶è¿Ÿåˆ° JVM å†…å­˜ä¸è¶³çš„æ—¶å€™ã€‚

###  **ä¸ºä»€ä¹ˆè¦æœ‰ä¸åŒçš„å¼•ç”¨ç±»å‹ï¼Ÿ**

â€‹	ä¸åƒ C è¯­è¨€ï¼Œæˆ‘ä»¬å¯ä»¥æ§åˆ¶å†…å­˜çš„ç”³è¯·å’Œé‡Šæ”¾ï¼Œ**åœ¨ Java ä¸­æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦é€‚å½“çš„æ§åˆ¶å¯¹è±¡è¢«å›æ”¶çš„æ—¶æœºï¼Œå› æ­¤å°±è¯ç”Ÿäº†ä¸åŒçš„å¼•ç”¨ç±»å‹ï¼Œå¯ä»¥è¯´ä¸åŒçš„å¼•ç”¨ç±»å‹å®åˆ™æ˜¯å¯¹ GC å›æ”¶æ—¶æœºä¸å¯æ§çš„å¦¥åã€‚**æœ‰ä»¥ä¸‹å‡ ä¸ªä½¿ç”¨åœºæ™¯å¯ä»¥å……åˆ†çš„è¯´æ˜ï¼š

- åˆ©ç”¨è½¯å¼•ç”¨å’Œå¼±å¼•ç”¨è§£å†³ OOM é—®é¢˜ã€‚ç”¨ä¸€ä¸ª HashMap æ¥ä¿å­˜å›¾ç‰‡çš„è·¯å¾„å’Œç›¸åº”å›¾ç‰‡å¯¹è±¡å…³è”çš„è½¯å¼•ç”¨ä¹‹é—´çš„æ˜ å°„å…³ç³»ï¼Œåœ¨å†…å­˜ä¸è¶³æ—¶ï¼ŒJVM ä¼šè‡ªåŠ¨å›æ”¶è¿™äº›ç¼“å­˜å›¾ç‰‡å¯¹è±¡æ‰€å ç”¨çš„ç©ºé—´ï¼Œä»è€Œæœ‰æ•ˆåœ°é¿å…äº† OOM çš„é—®é¢˜.
- é€šè¿‡è½¯å¼•ç”¨å®ç° Java å¯¹è±¡çš„é«˜é€Ÿç¼“å­˜ã€‚æ¯”å¦‚æˆ‘ä»¬åˆ›å»ºäº†ä¸€ Person çš„ç±»ï¼Œå¦‚æœæ¯æ¬¡éœ€è¦æŸ¥è¯¢ä¸€ä¸ªäººçš„ä¿¡æ¯ï¼Œå“ªæ€•æ˜¯å‡ ç§’ä¸­ä¹‹å‰åˆšåˆšæŸ¥è¯¢è¿‡çš„ï¼Œéƒ½è¦é‡æ–°æ„å»ºä¸€ä¸ªå®ä¾‹ï¼Œè¿™å°†å¼•èµ·å¤§é‡ Person å¯¹è±¡çš„æ¶ˆè€—ï¼Œå¹¶ä¸”ç”±äºè¿™äº›å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸç›¸å¯¹è¾ƒçŸ­ï¼Œä¼šå¼•èµ·å¤šæ¬¡ GC å½±å“æ€§èƒ½ã€‚æ­¤æ—¶ï¼Œé€šè¿‡è½¯å¼•ç”¨å’Œ HashMap çš„ç»“åˆå¯ä»¥æ„å»ºé«˜é€Ÿç¼“å­˜ï¼Œæä¾›æ€§èƒ½ã€‚

### æ€»ç»“ï¼š

| å¼•ç”¨ç±»å‹ | GCæ—¶JVMå†…å­˜å……è¶³ | GCæ—¶JVMå†…å­˜ä¸è¶³ |
| -------- | --------------- | --------------- |
| å¼ºå¼•ç”¨   | ä¸è¢«å›æ”¶        | ä¸è¢«å›æ”¶        |
| å¼±å¼•ç”¨   | è¢«å›æ”¶          | è¢«å›æ”¶          |
| è½¯å¼•ç”¨   | ä¸è¢«å›æ”¶        | è¢«å›æ”¶          |

## 4.JVM åƒåœ¾å›æ”¶ç®—æ³•

æœ‰å››ç§ç®—æ³•ï¼š

1. æ ‡è®°-æ¸…é™¤ç®—æ³•
2. æ ‡è®°-æ•´ç†ç®—æ³•
3. å¤åˆ¶ç®—æ³•
4. åˆ†ä»£æ”¶é›†ç®—æ³•

### **1ï¼‰æ ‡è®°-æ¸…é™¤ç®—æ³•**

æ ‡è®°-æ¸…é™¤ï¼ˆMark-Sweepï¼‰ç®—æ³•ï¼Œæ˜¯ç°ä»£åƒåœ¾å›æ”¶ç®—æ³•çš„æ€æƒ³åŸºç¡€ã€‚

**æ ‡è®°-æ¸…é™¤ç®—æ³•å°†åƒåœ¾å›æ”¶åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µï¼šæ ‡è®°é˜¶æ®µå’Œæ¸…é™¤é˜¶æ®µã€‚**

â€‹	ä¸€ç§å¯è¡Œçš„å®ç°æ˜¯ï¼Œ**åœ¨æ ‡è®°é˜¶æ®µï¼Œé¦–å…ˆé€šè¿‡æ ¹èŠ‚ç‚¹ï¼Œæ ‡è®°æ‰€æœ‰ä»æ ¹èŠ‚ç‚¹å¼€å§‹çš„å¯è¾¾å¯¹è±¡ã€‚**å› æ­¤ï¼Œæœªè¢«æ ‡è®°çš„å¯¹è±¡å°±æ˜¯æœªè¢«å¼•ç”¨çš„åƒåœ¾å¯¹è±¡ï¼ˆå¥½å¤šèµ„æ–™è¯´æ ‡è®°å‡ºè¦å›æ”¶çš„å¯¹è±¡ï¼Œå…¶å®æ˜ç™½å¤§æ¦‚æ„æ€å°±å¯ä»¥äº†ï¼‰ã€‚ç„¶åï¼Œ**åœ¨æ¸…é™¤é˜¶æ®µï¼Œæ¸…é™¤æ‰€æœ‰æœªè¢«æ ‡è®°çš„å¯¹è±¡ã€‚**

![æ ‡è®°-æ¸…é™¤ç®—æ³•](/Users/jack/Desktop/md/images/f07ac7c68994aa21b7b4271073ea4e5b.jpeg)

- ç¼ºç‚¹ï¼š
  - 1ã€æ•ˆç‡é—®é¢˜ï¼Œæ ‡è®°å’Œæ¸…é™¤ä¸¤ä¸ªè¿‡ç¨‹çš„æ•ˆç‡éƒ½ä¸é«˜ã€‚
  - 2ã€ç©ºé—´é—®é¢˜ï¼Œæ ‡è®°æ¸…é™¤ä¹‹åä¼šäº§ç”Ÿå¤§é‡ä¸è¿ç»­çš„å†…å­˜ç¢ç‰‡ï¼Œç©ºé—´ç¢ç‰‡å¤ªå¤šå¯èƒ½ä¼šå¯¼è‡´ä»¥ååœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­éœ€è¦åˆ†é…è¾ƒå¤§çš„å¯¹è±¡æ—¶ï¼Œæ— æ³•æ‰¾åˆ°è¶³å¤Ÿçš„è¿ç»­å†…å­˜è€Œä¸å¾—ä¸æå‰è§¦å‘å¦ä¸€æ¬¡åƒåœ¾æ”¶é›†åŠ¨ä½œã€‚

### **2ï¼‰æ ‡è®°-æ•´ç†ç®—æ³•**

â€‹	==æ ‡è®°æ•´ç†ç®—æ³•ï¼Œç±»ä¼¼ä¸æ ‡è®°æ¸…é™¤ç®—æ³•ï¼Œä¸è¿‡å®ƒæ ‡è®°å®Œå¯¹è±¡åï¼Œä¸æ˜¯ç›´æ¥å¯¹å¯å›æ”¶å¯¹è±¡è¿›è¡Œæ¸…ç†ï¼Œè€Œæ˜¯è®©æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡éƒ½å‘ä¸€ç«¯ç§»åŠ¨ï¼Œç„¶åç›´æ¥æ¸…ç†æ‰è¾¹ç•Œä»¥å¤–çš„å†…å­˜==ã€‚

![æ ‡è®°-æ•´ç†ç®—æ³•](/Users/jack/Desktop/md/images/52ea9a3813e09621c563b1cd4bdf0d22.jpeg)

- ä¼˜ç‚¹ï¼š
  - 1ã€ç›¸å¯¹æ ‡è®°æ¸…é™¤ç®—æ³•ï¼Œè§£å†³äº†å†…å­˜ç¢ç‰‡é—®é¢˜ã€‚
  - 2ã€æ²¡æœ‰å†…å­˜ç¢ç‰‡åï¼Œå¯¹è±¡åˆ›å»ºå†…å­˜åˆ†é…ä¹Ÿæ›´å¿«é€Ÿäº†ï¼ˆå¯ä»¥ä½¿ç”¨TLABè¿›è¡Œåˆ†é…ï¼‰ã€‚
- ç¼ºç‚¹ï¼š
  - 1ã€æ•ˆç‡é—®é¢˜ï¼Œï¼ˆåŒæ ‡è®°æ¸…é™¤ç®—æ³•ï¼‰æ ‡è®°å’Œæ•´ç†ä¸¤ä¸ªè¿‡ç¨‹çš„æ•ˆç‡éƒ½ä¸é«˜ã€‚

### **3ï¼‰å¤åˆ¶ç®—æ³•**

â€‹	å¤åˆ¶ç®—æ³•ï¼Œå¯ä»¥è§£å†³æ•ˆç‡é—®é¢˜ï¼Œ**å®ƒå°†å¯ç”¨å†…å­˜æŒ‰å®¹é‡åˆ’åˆ†ä¸ºå¤§å°ç›¸ç­‰çš„ä¸¤å—ï¼Œæ¯æ¬¡åªä½¿ç”¨å…¶ä¸­çš„ä¸€å—ï¼Œå½“è¿™ä¸€å—å†…å­˜ç”¨å®Œäº†ï¼Œå°±å°†è¿˜å­˜æ´»ç€çš„å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€å—ä¸Šé¢ï¼Œç„¶åå†æŠŠå·²ç»ä½¿ç”¨è¿‡çš„å†…å­˜ç©ºé—´ä¸€æ¬¡æ¸…ç†æ‰ï¼Œè¿™æ ·ä½¿å¾—æ¯æ¬¡éƒ½æ˜¯å¯¹æ•´ä¸ªåŠåŒºè¿›è¡Œå†…å­˜å›æ”¶ï¼Œå†…å­˜åˆ†é…æ—¶ä¹Ÿå°±ä¸ç”¨è€ƒè™‘å†…å­˜ç¢ç‰‡ç­‰å¤æ‚æƒ…å†µï¼Œåªè¦ç§»åŠ¨å †é¡¶æŒ‡é’ˆï¼ŒæŒ‰é¡ºåºåˆ†é…å†…å­˜å³å¯ï¼ˆè¿˜å¯ä½¿ç”¨TLABè¿›è¡Œé«˜æ•ˆåˆ†é…å†…å­˜ï¼‰ã€‚**

![å¤åˆ¶ç®—æ³•](/Users/jack/Desktop/md/images/cc3f228ca5353fd5deb4b22b7a9709e6.jpeg)

- å›¾çš„ä¸ŠåŠéƒ¨åˆ†æ˜¯æœªå›æ”¶å‰çš„å†…å­˜åŒºåŸŸï¼Œå›¾çš„ä¸‹åŠéƒ¨åˆ†æ˜¯å›æ”¶åçš„å†…å­˜åŒºåŸŸã€‚é€šè¿‡å›¾ï¼Œæˆ‘ä»¬å‘ç°ä¸ç®¡å›æ”¶å‰è¿˜æ˜¯å›æ”¶åéƒ½æœ‰ä¸€åŠçš„ç©ºé—´æœªè¢«åˆ©ç”¨ã€‚
- ä¼˜ç‚¹ï¼š
  - 1ã€æ•ˆç‡é«˜ï¼Œæ²¡æœ‰å†…å­˜ç¢ç‰‡ã€‚
- ç¼ºç‚¹ï¼š
  - 1ã€æµªè´¹ä¸€åŠçš„å†…å­˜ç©ºé—´ã€‚
  - 2ã€å¤åˆ¶æ”¶é›†ç®—æ³•åœ¨å¯¹è±¡å­˜æ´»ç‡è¾ƒé«˜æ—¶å°±è¦è¿›è¡Œè¾ƒå¤šçš„å¤åˆ¶æ“ä½œï¼Œæ•ˆç‡å°†ä¼šå˜ä½ã€‚

### **4ï¼‰åˆ†ä»£æ”¶é›†ç®—æ³•**

â€‹	å½“å‰å•†ä¸šè™šæ‹Ÿæœºéƒ½æ˜¯é‡‡ç”¨åˆ†ä»£æ”¶é›†ç®—æ³•ï¼Œå®ƒæ ¹æ®å¯¹è±¡å­˜æ´»å‘¨æœŸçš„ä¸åŒå°†å†…å­˜åˆ’åˆ†ä¸ºå‡ å—ï¼Œ**ä¸€èˆ¬æ˜¯æŠŠ Java å †åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Œç„¶åæ ¹æ®å„ä¸ªå¹´ä»£çš„ç‰¹ç‚¹é‡‡ç”¨æœ€é€‚å½“çš„æ”¶é›†ç®—æ³•ã€‚**

- åœ¨æ–°ç”Ÿä»£ä¸­ï¼Œæ¯æ¬¡åƒåœ¾æ”¶é›†éƒ½å‘ç°æœ‰å¤§æ‰¹å¯¹è±¡æ­»å»ï¼Œåªæœ‰å°‘é‡å­˜æ´»ï¼Œå°±é€‰ç”¨å¤åˆ¶ç®—æ³•ã€‚
- è€Œè€å¹´ä»£ä¸­ï¼Œå› ä¸ºå¯¹è±¡å­˜æ´»ç‡é«˜ï¼Œæ²¡æœ‰é¢å¤–ç©ºé—´å¯¹å®ƒè¿›è¡Œåˆ†é…æ‹…ä¿ï¼Œå°±å¿…é¡»ä½¿ç”¨â€œæ ‡è®°æ¸…ç†â€æˆ–è€…â€œæ ‡è®°æ•´ç†â€ç®—æ³•æ¥è¿›è¡Œå›æ”¶ã€‚

![åˆ†ä»£æ”¶é›†ç®—æ³•](/Users/jack/Desktop/md/images/fec52af474f1250831d46b541e0fe7a9.jpeg)

- å›¾çš„å·¦åŠéƒ¨åˆ†æ˜¯æœªå›æ”¶å‰çš„å†…å­˜åŒºåŸŸï¼Œå³åŠéƒ¨åˆ†æ˜¯å›æ”¶åçš„å†…å­˜åŒºåŸŸã€‚
- å¯¹è±¡åˆ†é…ç­–ç•¥ï¼š
  - ==å¯¹è±¡ä¼˜å…ˆåœ¨ Eden åŒºåŸŸåˆ†é…ï¼Œå¦‚æœå¯¹è±¡è¿‡å¤§ç›´æ¥åˆ†é…åˆ° Old åŒºåŸŸã€‚==
  - ==é•¿æ—¶é—´å­˜æ´»çš„å¯¹è±¡è¿›å…¥åˆ° Old åŒºåŸŸã€‚==
- æ”¹è¿›è‡ªå¤åˆ¶ç®—æ³•
  - ç°åœ¨çš„å•†ä¸šè™šæ‹Ÿæœºéƒ½é‡‡ç”¨è¿™ç§æ”¶é›†ç®—æ³•æ¥å›æ”¶æ–°ç”Ÿä»£ï¼ŒIBM å…¬å¸çš„ä¸“é—¨ç ”ç©¶è¡¨æ˜ï¼Œæ–°ç”Ÿä»£ä¸­çš„å¯¹è±¡ 98% æ˜¯â€œæœç”Ÿå¤•æ­»â€çš„ï¼Œæ‰€ä»¥å¹¶ä¸éœ€è¦æŒ‰ç…§ `1:1` çš„æ¯”ä¾‹æ¥åˆ’åˆ†å†…å­˜ç©ºé—´ï¼Œè€Œæ˜¯**å°†å†…å­˜åˆ†ä¸ºä¸€å—è¾ƒå¤§çš„ Eden ç©ºé—´å’Œä¸¤å—è¾ƒå°çš„ Survivor ç©ºé—´ï¼Œæ¯æ¬¡ä½¿ç”¨ Eden å’Œå…¶ä¸­ä¸€å— Survivor ã€‚**==å½“å›æ”¶æ—¶ï¼Œå°† Eden å’Œ Survivor ä¸­è¿˜å­˜æ´»ç€çš„å¯¹è±¡ä¸€æ¬¡æ€§åœ°å¤åˆ¶åˆ°å¦å¤–ä¸€å— Survivor ç©ºé—´ä¸Šï¼Œæœ€åæ¸…ç†æ‰ Eden å’Œåˆšæ‰ç”¨è¿‡çš„ Survivor ç©ºé—´ã€‚==
  - HotSpot è™šæ‹Ÿæœºé»˜è®¤ Eden å’Œ 2 å— Survivor çš„å¤§å°æ¯”ä¾‹æ˜¯ `8:1:1`ï¼Œä¹Ÿå°±æ˜¯æ¯æ¬¡æ–°ç”Ÿä»£ä¸­å¯ç”¨å†…å­˜ç©ºé—´ä¸ºæ•´ä¸ªæ–°ç”Ÿä»£å®¹é‡çš„ 90%ï¼ˆ80%+10%ï¼‰ï¼Œåªæœ‰ 10% çš„å†…å­˜ä¼šè¢«â€œæµªè´¹â€ã€‚å½“ç„¶ï¼Œ98% çš„å¯¹è±¡å¯å›æ”¶åªæ˜¯ä¸€èˆ¬åœºæ™¯ä¸‹çš„æ•°æ®ï¼Œæˆ‘ä»¬æ²¡æœ‰åŠæ³•ä¿è¯æ¯æ¬¡å›æ”¶éƒ½åªæœ‰ä¸å¤šäº 10% çš„å¯¹è±¡å­˜æ´»ï¼Œå½“ Survivor ç©ºé—´ä¸å¤Ÿç”¨æ—¶ï¼Œéœ€è¦ä¾èµ–å…¶ä»–å†…å­˜ï¼ˆè¿™é‡ŒæŒ‡è€å¹´ä»£ï¼‰è¿›è¡Œåˆ†é…æ‹…ä¿ï¼ˆHandle Promotionï¼‰ã€‚

## 5.å®‰å…¨ç‚¹

â€‹	SafePoint å®‰å…¨ç‚¹ï¼Œé¡¾åæ€ä¹‰æ˜¯æŒ‡ä¸€äº›ç‰¹å®šçš„ä½ç½®ï¼Œ**å½“çº¿ç¨‹è¿è¡Œåˆ°è¿™äº›ä½ç½®æ—¶ï¼Œçº¿ç¨‹çš„ä¸€äº›çŠ¶æ€å¯ä»¥è¢«ç¡®å®š**(the threadâ€™s representation of itâ€™s Java machine state is well described)ï¼Œæ¯”å¦‚è®°å½•OopMap çš„çŠ¶æ€ï¼Œä»è€Œç¡®å®š GC Root çš„ä¿¡æ¯ï¼Œä½¿ JVM å¯ä»¥å®‰å…¨çš„è¿›è¡Œä¸€äº›æ“ä½œï¼Œæ¯”å¦‚å¼€å§‹ GC ã€‚

### SafePoint æŒ‡çš„ç‰¹å®šä½ç½®ä¸»è¦æœ‰ï¼š

1. å¾ªç¯çš„æœ«å°¾ (é˜²æ­¢å¤§å¾ªç¯çš„æ—¶å€™ä¸€ç›´ä¸è¿›å…¥ Safepoint ï¼Œè€Œå…¶ä»–çº¿ç¨‹åœ¨ç­‰å¾…å®ƒè¿›å…¥ Safepoint )ã€‚
2. æ–¹æ³•è¿”å›å‰ã€‚
3. è°ƒç”¨æ–¹æ³•çš„ Call ä¹‹åã€‚
4. æŠ›å‡ºå¼‚å¸¸çš„ä½ç½®ã€‚

è¯¦ç»†çš„å†…å®¹ï¼Œå¯ä»¥çœ‹çœ‹ [ã€Šæ·±å…¥å­¦ä¹  JVM-JVM å®‰å…¨ç‚¹å’Œå®‰å…¨åŒºåŸŸã€‹](https://my.oschina.net/wenbo123/blog/1822414) ã€‚

### å¦‚ä½•ä½¿çº¿ç¨‹ä¸­æ–­

- ä¸»åŠ¨å¼

  > ä¸»åŠ¨å¼ JVM è®¾ç½®ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œçº¿ç¨‹å»æŒ‰ç…§æŸç§ç­–ç•¥æ£€æŸ¥è¿™ä¸ªå˜é‡ä¸€æ—¦å‘ç°æ˜¯ SafePoint å°±ä¸»åŠ¨æŒ‚èµ·ã€‚
  >
  > HostSpot è™šæ‹Ÿæœºé‡‡ç”¨çš„æ˜¯ä¸»åŠ¨å¼ä½¿çº¿ç¨‹ä¸­æ–­ã€‚

- è¢«åŠ¨å¼

  > è¢«åŠ¨å¼å°±æ˜¯å‘ä¸ªä¿¡å·ï¼Œä¾‹å¦‚å…³æœºã€Control+C ï¼Œå¸¦æ¥çš„é—®é¢˜å°±æ˜¯ä¸å¯æ§ï¼Œå‘ä¿¡å·çš„æ—¶å€™ä¸çŸ¥é“çº¿ç¨‹å¤„äºä»€ä¹ˆçŠ¶æ€ã€‚

- å®‰å…¨åŒºåŸŸ

  > å¦‚æœç¨‹åºé•¿æ—¶é—´ä¸æ‰§è¡Œï¼Œæ¯”å¦‚çº¿ç¨‹è°ƒç”¨çš„ sleep æ–¹æ³•ï¼Œè¿™æ—¶å€™ç¨‹åºæ— æ³•å“åº” JVM ä¸­æ–­è¯·æ±‚è¿™æ—¶å€™çº¿ç¨‹æ— æ³•åˆ°è¾¾å®‰å…¨ç‚¹ï¼Œæ˜¾ç„¶ JVM ä¹Ÿä¸å¯èƒ½ç­‰å¾…ç¨‹åºå”¤é†’ï¼Œè¿™æ—¶å€™å°±éœ€è¦å®‰å…¨åŒºåŸŸäº†ã€‚
  >
  > **å®‰å…¨åŒºåŸŸæ˜¯æŒ‡ä¸€æ®µä»£ç ç‰‡ä¸­ï¼Œå¼•ç”¨å…³ç³»ä¸ä¼šå‘ç”Ÿå˜åŒ–ï¼Œåœ¨è¿™ä¸ªåŒºåŸŸä»»ä½•åœ°æ–¹ GC éƒ½æ˜¯å®‰å…¨çš„ï¼Œå®‰å…¨åŒºåŸŸå¯ä»¥çœ‹åšæ˜¯å®‰å…¨ç‚¹çš„ä¸€ä¸ªæ‰©å±•ã€‚**
  >
  > - çº¿ç¨‹æ‰§è¡Œåˆ°å®‰å…¨åŒºåŸŸçš„ä»£ç æ—¶ï¼Œé¦–å…ˆæ ‡è¯†è‡ªå·±è¿›å…¥äº†å®‰å…¨åŒºåŸŸï¼Œè¿™æ · GC æ—¶å°±ä¸ç”¨ç®¡è¿›å…¥å®‰å…¨åŒºåŸŸçš„çº¿ç¨‹äº†.
  > - çº¿ç¨‹è¦ç¦»å¼€å®‰å…¨åŒºåŸŸæ—¶å°±æ£€æŸ¥ JVM æ˜¯å¦å®Œæˆäº† GC Roots æšä¸¾ï¼ˆæˆ–è€…æ•´ä¸ª GC è¿‡ç¨‹ï¼‰ï¼Œå¦‚æœå®Œæˆå°±ç»§ç»­æ‰§è¡Œï¼Œå¦‚æœæ²¡æœ‰å®Œæˆå°±ç­‰å¾…ç›´åˆ°æ”¶åˆ°å¯ä»¥å®‰å…¨ç¦»å¼€çš„ä¿¡å·ã€‚

## 6.JVM åƒåœ¾æ”¶é›†å™¨

**å¦‚æœè¯´æ”¶é›†ç®—æ³•æ˜¯å†…å­˜å›æ”¶çš„æ–¹æ³•è®ºï¼Œé‚£ä¹ˆåƒåœ¾æ”¶é›†å™¨å°±æ˜¯å†…å­˜å›æ”¶çš„å…·ä½“å®ç°ã€‚**

### 6.1 æ–°ç”Ÿä»£æ”¶é›†å™¨

- Serial æ”¶é›†å™¨

  - åœ¨è¿›è¡Œåƒåœ¾æ”¶é›†å·¥ä½œçš„æ—¶å€™==å¿…é¡»æš‚åœå…¶ä»–æ‰€æœ‰çš„å·¥ä½œçº¿ç¨‹ï¼ˆ **"Stop The World"** ï¼‰ï¼Œç›´åˆ°å®ƒæ”¶é›†ç»“æŸ==ã€‚

- ParNew æ”¶é›†å™¨

  > ParNew æ”¶é›†å™¨ï¼Œæ˜¯ Serial æ”¶é›†å™¨çš„å¤šçº¿ç¨‹ç‰ˆã€‚

- Parallel Scavenge æ”¶é›†å™¨

### 6.2 è€å¹´ä»£æ”¶é›†å™¨

- Serial Old æ”¶é›†å™¨
  - Serial Old æ”¶é›†å™¨ï¼Œ**æ˜¯ Serial æ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬ã€‚**
- Parallel Old æ”¶é›†å™¨
  - Parallel Old æ”¶é›†å™¨ï¼Œ**æ˜¯ Parallel Scavenge æ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬ã€‚**
- CMS æ”¶é›†å™¨
  - ä¸€ç§ä»¥==è·å–æœ€çŸ­å›æ”¶åœé¡¿æ—¶é—´ä¸ºç›®æ ‡çš„æ”¶é›†å™¨ã€‚==
  - ==ç¬¬ä¸€æ¬¡å®ç°äº†è®©åƒåœ¾æ”¶é›†çº¿ç¨‹ä¸ç”¨æˆ·çº¿ç¨‹ï¼ˆåŸºæœ¬ä¸Šï¼‰åŒæ—¶å·¥ä½œã€‚==

- æ–°ç”Ÿä»£ + è€å¹´ä»£æ”¶é›†å™¨
  - G1 æ”¶é›†å™¨
    - æœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š
      - å¹¶è¡Œä¸å¹¶å‘**ï¼š**G1èƒ½å……åˆ†åˆ©ç”¨CPUã€å¤šæ ¸ç¯å¢ƒä¸‹çš„ç¡¬ä»¶ä¼˜åŠ¿ï¼Œä½¿ç”¨å¤šä¸ªCPUï¼ˆCPUæˆ–è€…CPUæ ¸å¿ƒï¼‰æ¥ç¼©çŸ­Stop-The-Worldåœé¡¿æ—¶é—´ã€‚**éƒ¨åˆ†å…¶ä»–æ”¶é›†å™¨åŸæœ¬éœ€è¦åœé¡¿Javaçº¿ç¨‹æ‰§è¡Œçš„GCåŠ¨ä½œï¼ŒG1æ”¶é›†å™¨ä»ç„¶å¯ä»¥é€šè¿‡å¹¶å‘çš„æ–¹å¼è®©javaç¨‹åºç»§ç»­æ‰§è¡Œã€‚
      - **åˆ†ä»£æ”¶é›†**ï¼šè™½ç„¶G1å¯ä»¥ä¸éœ€è¦å…¶ä»–æ”¶é›†å™¨é…åˆå°±èƒ½ç‹¬ç«‹ç®¡ç†æ•´ä¸ªGCå †ï¼Œä½†æ˜¯è¿˜æ˜¯ä¿ç•™äº†åˆ†ä»£çš„æ¦‚å¿µã€‚
      - **ç©ºé—´æ•´åˆ**ï¼šä¸CMSçš„â€œæ ‡è®°--æ¸…ç†â€ç®—æ³•ä¸åŒï¼Œ**G1ä»æ•´ä½“æ¥çœ‹æ˜¯åŸºäºâ€œæ ‡è®°æ•´ç†â€ç®—æ³•å®ç°çš„æ”¶é›†å™¨ï¼›ä»å±€éƒ¨ä¸Šæ¥çœ‹æ˜¯åŸºäºâ€œå¤åˆ¶â€ç®—æ³•å®ç°çš„ã€‚**
      - **å¯é¢„æµ‹çš„åœé¡¿**ï¼šè¿™æ˜¯G1ç›¸å¯¹äºCMSçš„å¦ä¸€ä¸ªå¤§ä¼˜åŠ¿ï¼Œé™ä½åœé¡¿æ—¶é—´æ˜¯G1 å’Œ CMS å…±åŒçš„å…³æ³¨ç‚¹ï¼Œä½†G1 é™¤äº†è¿½æ±‚ä½åœé¡¿å¤–ï¼Œè¿˜èƒ½å»ºç«‹å¯é¢„æµ‹çš„åœé¡¿æ—¶é—´æ¨¡å‹ï¼Œèƒ½è®©ä½¿ç”¨è€…æ˜ç¡®æŒ‡å®šåœ¨ä¸€ä¸ªé•¿åº¦ä¸ºMæ¯«ç§’çš„æ—¶é—´ç‰‡æ®µå†…ã€‚
    - G1æ”¶é›†å™¨çš„è¿ä½œå¤§è‡´åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š
      - **åˆå§‹æ ‡è®°**
      - **å¹¶å‘æ ‡è®°**
      - **æœ€ç»ˆæ ‡è®°**
      - **ç­›é€‰å›æ”¶**
  - ZGC æ”¶é›†å™¨(Java11)

### æ€»ç»“ï¼š

| æ”¶é›†å™¨                | ä¸²è¡Œã€å¹¶è¡Œorå¹¶å‘ | æ–°ç”Ÿä»£/è€å¹´ä»£ | ç®—æ³•               | ç›®æ ‡         | é€‚ç”¨åœºæ™¯                                  |
| --------------------- | ---------------- | ------------- | ------------------ | ------------ | ----------------------------------------- |
| **Serial**            | ä¸²è¡Œ             | æ–°ç”Ÿä»£        | å¤åˆ¶ç®—æ³•           | å“åº”é€Ÿåº¦ä¼˜å…ˆ | å•CPUç¯å¢ƒä¸‹çš„Clientæ¨¡å¼                   |
| **Serial Old**        | ä¸²è¡Œ             | è€å¹´ä»£        | æ ‡è®°-æ•´ç†          | å“åº”é€Ÿåº¦ä¼˜å…ˆ | å•CPUç¯å¢ƒä¸‹çš„Clientæ¨¡å¼ã€CMSçš„åå¤‡é¢„æ¡ˆ    |
| **ParNew**            | å¹¶è¡Œ             | æ–°ç”Ÿä»£        | å¤åˆ¶ç®—æ³•           | å“åº”é€Ÿåº¦ä¼˜å…ˆ | å¤šCPUç¯å¢ƒæ—¶åœ¨Serveræ¨¡å¼ä¸‹ä¸CMSé…åˆ        |
| **Parallel Scavenge** | å¹¶è¡Œ             | æ–°ç”Ÿä»£        | å¤åˆ¶ç®—æ³•           | ååé‡ä¼˜å…ˆ   | åœ¨åå°è¿ç®—è€Œä¸éœ€è¦å¤ªå¤šäº¤äº’çš„ä»»åŠ¡          |
| **Parallel Old**      | å¹¶è¡Œ             | è€å¹´ä»£        | æ ‡è®°-æ•´ç†          | ååé‡ä¼˜å…ˆ   | åœ¨åå°è¿ç®—è€Œä¸éœ€è¦å¤ªå¤šäº¤äº’çš„ä»»åŠ¡          |
| **CMS**               | å¹¶å‘             | è€å¹´ä»£        | æ ‡è®°-æ¸…é™¤          | å“åº”é€Ÿåº¦ä¼˜å…ˆ | é›†ä¸­åœ¨äº’è”ç½‘ç«™æˆ–B/Sç³»ç»ŸæœåŠ¡ç«¯ä¸Šçš„Javaåº”ç”¨ |
| **G1**                | å¹¶å‘             | both          | æ ‡è®°-æ•´ç†+å¤åˆ¶ç®—æ³• | å“åº”é€Ÿåº¦ä¼˜å…ˆ | é¢å‘æœåŠ¡ç«¯åº”ç”¨ï¼Œå°†æ¥æ›¿æ¢CMS               |

å…³äºæ¯ç§åƒåœ¾æ”¶é›†å™¨çš„è¯´æ˜ï¼Œè¯·çœ‹ å¦‚ä¸‹æ–‡ç« ï¼š

- [ã€Šæ·±å…¥ç†è§£ JVM(3) â€”â€” 7 ç§åƒåœ¾æ”¶é›†å™¨ã€‹](https://crowhawk.github.io/2017/08/15/jvm_3/)
- [ã€Šä¸€æ–‡è¯»æ‡‚ Java 11 çš„ ZGC ä¸ºä½•å¦‚æ­¤é«˜æ•ˆã€‹](https://zhuanlan.zhihu.com/p/43608166)

### **G1 å’Œ CMS çš„åŒºåˆ«**

- CMS ï¼šå¹¶å‘æ ‡è®°æ¸…é™¤ã€‚ä»–çš„ä¸»è¦æ­¥éª¤æœ‰ï¼šåˆå§‹æ”¶é›†ï¼Œå¹¶å‘æ ‡è®°ï¼Œé‡æ–°æ ‡è®°ï¼Œå¹¶å‘æ¸…é™¤ï¼ˆåˆ é™¤ï¼‰ã€é‡ç½®ã€‚

- G1ï¼šä¸»è¦æ­¥éª¤ï¼šåˆå§‹æ ‡è®°ï¼Œå¹¶å‘æ ‡è®°ï¼Œé‡æ–°æ ‡è®°ï¼Œå¤åˆ¶æ¸…é™¤ï¼ˆæ•´ç†ï¼‰

- CMS çš„ç¼ºç‚¹æ˜¯å¯¹ CPU çš„è¦æ±‚æ¯”è¾ƒé«˜ã€‚G1æ˜¯å°†å†…å­˜åŒ–æˆäº†å¤šå—ï¼Œæ‰€æœ‰å¯¹å†…æ®µçš„å¤§å°æœ‰å¾ˆå¤§çš„è¦æ±‚ã€‚

- **CMSæ˜¯æ¸…é™¤ï¼Œæ‰€ä»¥ä¼šå­˜åœ¨å¾ˆå¤šçš„å†…å­˜ç¢ç‰‡ã€‚G1æ˜¯æ•´ç†ï¼Œæ‰€ä»¥ç¢ç‰‡ç©ºé—´è¾ƒå°ã€‚**

- G1 å’Œ CMS éƒ½æ˜¯å“åº”ä¼˜å…ˆï¼Œä»–ä»¬çš„ç›®çš„éƒ½æ˜¯å°½é‡æ§åˆ¶ STW æ—¶é—´ã€‚

  > G1 å’Œ CMS çš„ Full GC éƒ½æ˜¯å•çº¿ç¨‹ mark sweep compact ç®—æ³•ï¼Œç›´åˆ° JDK10 æ‰ä¼˜åŒ–ä¸ºå¹¶è¡Œçš„ã€‚

å…·ä½“å¯ä»¥çœ‹çœ‹ [ã€ŠGC ä¼˜åŒ–çš„ä¸€äº›æ€»ç»“ã€‹](http://engineering.xueqiu.com/blog/2015/06/25/jvm-gc-tuning/) çš„åˆ†æã€‚

**CMS ç®—æ³•çš„è¿‡ç¨‹ï¼ŒCMS å›æ”¶è¿‡ç¨‹ä¸­ JVM æ˜¯å¦éœ€è¦æš‚åœï¼Ÿ**

ä¼šæœ‰çŸ­æš‚çš„åœé¡¿ã€‚è¯¦ç»†çš„ï¼Œå¯ä»¥çœ‹çœ‹ [ã€Š[jvm\][é¢è¯•] å¹¶å‘æ”¶é›†å™¨ CMS(Concurrent Mark-Sweep)ã€‹](https://blog.csdn.net/wfh6732/article/details/57490195) ã€‚

**å¦‚ä½•ä½¿ç”¨æŒ‡å®šçš„åƒåœ¾æ”¶é›†å™¨**

| é…ç½®                    | æè¿°                                     |
| ----------------------- | ---------------------------------------- |
| -XX:+UserSerialGC       | ä¸²è¡Œåƒåœ¾æ”¶é›†å™¨                           |
| -XX:+UserParrallelGC    | å¹¶è¡Œåƒåœ¾æ”¶é›†å™¨                           |
| -XX:+UseConcMarkSweepGC | å¹¶å‘æ ‡è®°æ‰«æåƒåœ¾å›æ”¶å™¨                   |
| -XX:ParallelCMSThreads  | å¹¶å‘æ ‡è®°æ‰«æåƒåœ¾å›æ”¶å™¨ =ä¸ºä½¿ç”¨çš„çº¿ç¨‹æ•°é‡ |
| -XX:+UseG1GC            | G1åƒåœ¾å›æ”¶å™¨                             |

## 7.å¯¹è±¡åˆ†é…è§„åˆ™

â€‹	**å¤§å¯¹è±¡å°±æ˜¯éœ€è¦å¤§é‡è¿ç»­å†…å­˜ç©ºé—´çš„å¯¹è±¡ï¼ˆæ¯”å¦‚ï¼šå­—ç¬¦ä¸²ã€æ•°ç»„ï¼‰ã€‚**

### 7.1 å¯¹è±¡ä¼˜å…ˆåˆ†é…åœ¨ Eden åŒºã€‚

> å¦‚æœ Eden åŒºæ— æ³•åˆ†é…ï¼Œé‚£ä¹ˆå°è¯•æŠŠæ´»ç€çš„å¯¹è±¡æ”¾åˆ° Survivor0 ä¸­å»**ï¼ˆMinor GCï¼‰**
>
> - å¦‚æœ Survivor0 å¯ä»¥æ”¾å…¥ï¼Œé‚£ä¹ˆæ”¾å…¥ä¹‹åæ¸…é™¤ Eden åŒºã€‚
> - **å¦‚æœ Survivor0 ä¸å¯ä»¥æ”¾å…¥ï¼Œé‚£ä¹ˆå°è¯•æŠŠ Eden å’Œ Survivor0 çš„å­˜æ´»å¯¹è±¡æ”¾åˆ° Survivor1 ä¸­ã€‚**
>   - å¦‚æœ Survivor1 å¯ä»¥æ”¾å…¥ï¼Œé‚£ä¹ˆæ”¾å…¥ Survivor1 ä¹‹åæ¸…é™¤ Eden å’Œ Survivor0 ï¼Œä¹‹åå†æŠŠ Survivor1 ä¸­çš„å¯¹è±¡å¤åˆ¶åˆ° Survivor0 ä¸­ï¼Œä¿æŒ Survivor1 ä¸€ç›´ä¸ºç©ºã€‚
>   - **å¦‚æœ Survivor1 ä¸å¯ä»¥æ”¾å…¥ï¼Œé‚£ä¹ˆç›´æ¥æŠŠå®ƒä»¬æ”¾å…¥åˆ°è€å¹´ä»£ä¸­ï¼Œ**å¹¶æ¸…é™¤ Eden å’Œ Survivor0 ï¼Œè¿™ä¸ªè¿‡ç¨‹ä¹Ÿç§°ä¸º**åˆ†é…æ‹…ä¿**ã€‚
>
> ==psï¼šæ¸…é™¤ Edenã€Survivor åŒºï¼Œå°±æ˜¯ Minor GC ã€‚==
>
> æ€»ç»“æ¥è¯´ï¼Œåˆ†é…çš„é¡ºåºæ˜¯ï¼šæ–°ç”Ÿä»£ï¼ˆEden => Survivor0 => Survivor1ï¼‰=> è€å¹´ä»£

### 7.2 å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£

> â€‹	è¿™æ ·åšçš„ç›®çš„æ˜¯ï¼Œé¿å…åœ¨ Eden åŒºå’Œä¸¤ä¸ª Survivor åŒºä¹‹é—´å‘ç”Ÿå¤§é‡çš„å†…å­˜æ‹·è´ï¼ˆ**æ–°ç”Ÿä»£é‡‡ç”¨å¤åˆ¶ç®—æ³•æ”¶é›†å†…å­˜**ï¼‰ã€‚

### 7.3 é•¿æœŸå­˜æ´»çš„å¯¹è±¡è¿›å…¥è€å¹´ä»£ã€‚

> â€‹	**è™šæ‹Ÿæœºä¸ºæ¯ä¸ªå¯¹è±¡å®šä¹‰äº†ä¸€ä¸ªå¹´é¾„è®¡æ•°å™¨ï¼Œå¦‚æœå¯¹è±¡ç»è¿‡äº† 1 æ¬¡ Minor GCï¼Œé‚£ä¹ˆå¯¹è±¡ä¼šè¿›å…¥ Survivor åŒºï¼Œä¹‹åæ¯ç»è¿‡ä¸€æ¬¡ Minor GC é‚£ä¹ˆå¯¹è±¡çš„å¹´é¾„åŠ  1 ï¼ŒçŸ¥é“è¾¾åˆ°é˜€å€¼å¯¹è±¡è¿›å…¥è€å¹´åŒºã€‚**

### 7.4 åŠ¨æ€åˆ¤æ–­å¯¹è±¡çš„å¹´é¾„ã€‚

> â€‹	ä¸ºäº†æ›´å¥½çš„é€‚ç”¨ä¸åŒç¨‹åºçš„å†…å­˜æƒ…å†µï¼Œè™šæ‹Ÿæœºå¹¶ä¸æ˜¯æ°¸è¿œè¦æ±‚å¯¹è±¡çš„å¹´é¾„å¿…é¡»è¾¾åˆ° MaxTenuringThreshold æ‰èƒ½æ™‹å‡è€å¹´ä»£ã€‚
>
> â€‹	==å¦‚æœ Survivor åŒºä¸­**ç›¸åŒå¹´é¾„**çš„æ‰€æœ‰å¯¹è±¡å¤§å°çš„æ€»å’Œå¤§äº Survivor ç©ºé—´çš„ä¸€åŠï¼Œå¹´é¾„å¤§äºæˆ–ç­‰äºè¯¥å¹´é¾„çš„å¯¹è±¡å¯ä»¥ç›´æ¥è¿›å…¥è€å¹´ä»£ã€‚==

### 7.5 ç©ºé—´åˆ†é…æ‹…ä¿ã€‚

> â€‹	æ¯æ¬¡è¿›è¡Œ Minor GC æ—¶**ï¼ŒJVM ä¼šè®¡ç®— Survivor åŒºç§»è‡³è€å¹´åŒºçš„å¯¹è±¡çš„å¹³å‡å¤§å°ï¼Œå¦‚æœè¿™ä¸ªå€¼å¤§äºè€å¹´åŒºçš„å‰©ä½™å€¼å¤§å°åˆ™è¿›è¡Œä¸€æ¬¡ Full GC ï¼Œ**å¦‚æœå°äºæ£€æŸ¥ HandlePromotionFailure è®¾ç½®ï¼Œå¦‚æœ `true` åˆ™åªè¿›è¡Œ Monitor GC ï¼Œå¦‚æœ `false` åˆ™è¿›è¡Œ Full GC ã€‚

å¦‚ä¸‹æ˜¯ä¸€å¼ å¯¹è±¡åˆ›å»ºæ—¶ï¼Œåˆ†é…å†…å­˜çš„å›¾ï¼š![å†…å­˜åˆ†é…](/Users/jack/Desktop/md/images/bc22a30cbe93b8dedda080144a73b613.png)

### 7.6 **ä¸ºä»€ä¹ˆæ–°ç”Ÿä»£å†…å­˜éœ€è¦æœ‰ä¸¤ä¸ª Survivor åŒº**

#### 1 ä¸ºä»€ä¹ˆè¦æœ‰SurvivoråŒº

â€‹	å…ˆä¸å»æƒ³ä¸ºä»€ä¹ˆæœ‰ä¸¤ä¸ªSurvivoråŒºï¼Œç¬¬ä¸€ä¸ªé—®é¢˜æ˜¯ï¼Œè®¾ç½®SurvivoråŒºçš„æ„ä¹‰åœ¨å“ªé‡Œï¼Ÿ 
![å †å†…å­˜åˆ†ç±»](/Users/jack/Desktop/md/images/20160516144358110.jpeg)

â€‹	**å¦‚æœæ²¡æœ‰Survivorï¼ŒEdenåŒºæ¯è¿›è¡Œä¸€æ¬¡Minor GCï¼Œå­˜æ´»çš„å¯¹è±¡å°±ä¼šè¢«é€åˆ°è€å¹´ä»£ã€‚è€å¹´ä»£å¾ˆå¿«è¢«å¡«æ»¡ï¼Œè§¦å‘Major GC**ï¼ˆå› ä¸ºMajor GCä¸€èˆ¬ä¼´éšç€Minor GCï¼Œä¹Ÿå¯ä»¥çœ‹åšè§¦å‘äº†Full GCï¼‰ã€‚**è€å¹´ä»£çš„å†…å­˜ç©ºé—´è¿œå¤§äºæ–°ç”Ÿä»£ï¼Œè¿›è¡Œä¸€æ¬¡Full GCæ¶ˆè€—çš„æ—¶é—´æ¯”Minor GCé•¿å¾—å¤šã€‚**é¢‘å‘çš„Full GCæ¶ˆè€—çš„æ—¶é—´æ˜¯éå¸¸å¯è§‚çš„ï¼Œè¿™ä¸€ç‚¹ä¼šå½±å“å¤§å‹ç¨‹åºçš„æ‰§è¡Œå’Œå“åº”é€Ÿåº¦ï¼Œæ›´ä¸è¦è¯´æŸäº›è¿æ¥ä¼šå› ä¸ºè¶…æ—¶å‘ç”Ÿè¿æ¥é”™è¯¯äº†ã€‚

æœ‰ä»¥ä¸‹çš„è§£å†³æ–¹æ¡ˆï¼š

| æ–¹æ¡ˆ           | ä¼˜ç‚¹                                        | ç¼ºç‚¹                                                      |
| -------------- | ------------------------------------------- | --------------------------------------------------------- |
| å¢åŠ è€å¹´ä»£ç©ºé—´ | æ›´å¤šå­˜æ´»å¯¹è±¡æ‰èƒ½å¡«æ»¡è€å¹´ä»£ã€‚é™ä½Full GCé¢‘ç‡ | éšç€è€å¹´ä»£ç©ºé—´åŠ å¤§ï¼Œä¸€æ—¦å‘ç”ŸFull GCï¼Œæ‰§è¡Œæ‰€éœ€è¦çš„æ—¶é—´æ›´é•¿ |
| å‡å°‘è€å¹´ä»£ç©ºé—´ | Full GCæ‰€éœ€æ—¶é—´å‡å°‘                         | è€å¹´ä»£å¾ˆå¿«è¢«å­˜æ´»å¯¹è±¡å¡«æ»¡ï¼ŒFull GCé¢‘ç‡å¢åŠ                  |

â€‹	æ˜¾è€Œæ˜“è§ï¼Œæ²¡æœ‰Survivorçš„è¯ï¼Œä¸Šè¿°ä¸¤ç§è§£å†³æ–¹æ¡ˆéƒ½ä¸èƒ½ä»æ ¹æœ¬ä¸Šè§£å†³é—®é¢˜ã€‚

æˆ‘ä»¬å¯ä»¥å¾—åˆ°ç¬¬ä¸€æ¡ç»“è®ºï¼š**Survivorçš„å­˜åœ¨æ„ä¹‰ï¼Œå°±æ˜¯å‡å°‘è¢«é€åˆ°è€å¹´ä»£çš„å¯¹è±¡ï¼Œè¿›è€Œå‡å°‘Full GCçš„å‘ç”Ÿï¼ŒSurvivorçš„é¢„ç­›é€‰ä¿è¯ï¼Œåªæœ‰ç»å†16æ¬¡Minor GCè¿˜èƒ½åœ¨æ–°ç”Ÿä»£ä¸­å­˜æ´»çš„å¯¹è±¡ï¼Œæ‰ä¼šè¢«é€åˆ°è€å¹´ä»£ã€‚**

#### 2 ä¸ºä»€ä¹ˆè¦è®¾ç½®ä¸¤ä¸ªSurvivoråŒº

â€‹	**è®¾ç½®ä¸¤ä¸ªSurvivoråŒºæœ€å¤§çš„å¥½å¤„å°±æ˜¯è§£å†³äº†ç¢ç‰‡åŒ–**ã€‚
â€‹	åˆšåˆšæ–°å»ºçš„å¯¹è±¡åœ¨Edenä¸­ï¼Œä¸€æ—¦Edenæ»¡äº†ï¼Œè§¦å‘ä¸€æ¬¡Minor GCï¼ŒEdenä¸­çš„å­˜æ´»å¯¹è±¡å°±ä¼šè¢«ç§»åŠ¨åˆ°SurvivoråŒºã€‚è¿™æ ·ç»§ç»­å¾ªç¯ä¸‹å»ï¼Œä¸‹ä¸€æ¬¡Edenæ»¡äº†çš„æ—¶å€™ï¼Œé—®é¢˜æ¥äº†ï¼Œæ­¤æ—¶è¿›è¡ŒMinor GCï¼ŒEdenå’ŒSurvivorå„æœ‰ä¸€äº›å­˜æ´»å¯¹è±¡ï¼Œå¦‚æœæ­¤æ—¶æŠŠEdenåŒºçš„å­˜æ´»å¯¹è±¡ç¡¬æ”¾åˆ°SurvivoråŒºï¼Œå¾ˆæ˜æ˜¾è¿™ä¸¤éƒ¨åˆ†å¯¹è±¡æ‰€å æœ‰çš„å†…å­˜æ˜¯ä¸è¿ç»­çš„ï¼Œä¹Ÿå°±å¯¼è‡´äº†å†…å­˜**ç¢ç‰‡åŒ–**ã€‚ 
â€‹	å¦‚ä¸‹å›¾ï¼Œå…¶ä¸­è‰²å—ä»£è¡¨å¯¹è±¡ï¼Œç™½è‰²æ¡†åˆ†åˆ«ä»£è¡¨EdenåŒºï¼ˆå¤§ï¼‰å’ŒSurvivoråŒºï¼ˆå°ï¼‰ã€‚**EdenåŒºç†æ‰€å½“ç„¶å¤§ä¸€äº›ï¼Œå¦åˆ™æ–°å»ºå¯¹è±¡å¾ˆå¿«å°±å¯¼è‡´EdenåŒºæ»¡ï¼Œè¿›è€Œè§¦å‘Minor GCï¼Œæœ‰æ‚–äºåˆè¡·ã€‚** 
![ä¸€ä¸ªSurvivoråŒºå¸¦æ¥ç¢ç‰‡åŒ–](/Users/jack/Desktop/md/images/20160516173704870.png)

â€‹	é‚£ä¹ˆï¼Œé¡ºç†æˆç« çš„ï¼Œåº”è¯¥å»ºç«‹ä¸¤å—SurvivoråŒºï¼Œåˆšåˆšæ–°å»ºçš„å¯¹è±¡åœ¨Edenä¸­ï¼Œç»å†ä¸€æ¬¡Minor GCï¼ŒEdenä¸­çš„å­˜æ´»å¯¹è±¡å°±ä¼šè¢«ç§»åŠ¨åˆ°ç¬¬ä¸€å—survivor space S0ï¼ŒEdenè¢«æ¸…ç©ºï¼›ç­‰EdenåŒºå†æ»¡äº†ï¼Œå°±å†è§¦å‘ä¸€æ¬¡Minor GCï¼ŒEdenå’ŒS0ä¸­çš„å­˜æ´»å¯¹è±¡åˆä¼šè¢«å¤åˆ¶é€å…¥ç¬¬äºŒå—survivor space S1ï¼ˆ**è¿™ä¸ªè¿‡ç¨‹éå¸¸é‡è¦ï¼Œå› ä¸ºè¿™ç§å¤åˆ¶ç®—æ³•ä¿è¯äº†S1ä¸­æ¥è‡ªS0å’ŒEdenä¸¤éƒ¨åˆ†çš„å­˜æ´»å¯¹è±¡å ç”¨è¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œé¿å…äº†ç¢ç‰‡åŒ–çš„å‘ç”Ÿ**ï¼‰ã€‚S0å’ŒEdenè¢«æ¸…ç©ºï¼Œç„¶åä¸‹ä¸€è½®S0ä¸S1äº¤æ¢è§’è‰²ï¼Œå¦‚æ­¤å¾ªç¯å¾€å¤ã€‚**å¦‚æœå¯¹è±¡çš„å¤åˆ¶æ¬¡æ•°è¾¾åˆ°16æ¬¡ï¼Œè¯¥å¯¹è±¡å°±ä¼šè¢«é€åˆ°è€å¹´ä»£ä¸­ã€‚**ä¸‹å›¾ä¸­æ¯éƒ¨åˆ†çš„æ„ä¹‰å’Œä¸Šä¸€å¼ å›¾ä¸€æ ·ã€‚ 
![ä¸¤å—Survivoré¿å…ç¢ç‰‡åŒ–](/Users/jack/Desktop/md/images/20160516174938778.png) 
â€‹	ä¸Šè¿°æœºåˆ¶æœ€å¤§çš„å¥½å¤„å°±æ˜¯ï¼Œæ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œ==**æ°¸è¿œæœ‰ä¸€ä¸ªsurvivor spaceæ˜¯ç©ºçš„ï¼Œå¦ä¸€ä¸ªéç©ºçš„survivor spaceæ— ç¢ç‰‡**==ã€‚

â€‹	é‚£ä¹ˆï¼ŒSurvivorä¸ºä»€ä¹ˆä¸åˆ†æ›´å¤šå—å‘¢ï¼Ÿæ¯”æ–¹è¯´åˆ†æˆä¸‰ä¸ªã€å››ä¸ªã€äº”ä¸ª?æ˜¾ç„¶ï¼Œå¦‚æœSurvivoråŒºå†ç»†åˆ†ä¸‹å»ï¼Œæ¯ä¸€å—çš„ç©ºé—´å°±ä¼šæ¯”è¾ƒå°ï¼Œå¾ˆå®¹æ˜“å¯¼è‡´SurvivoråŒºæ»¡ï¼Œå› æ­¤ï¼Œæˆ‘è®¤ä¸ºä¸¤å—SurvivoråŒºæ˜¯ç»è¿‡æƒè¡¡ä¹‹åçš„æœ€ä½³æ–¹æ¡ˆã€‚

**æ°¸è¿œæœ‰ä¸€ä¸ªsurvivor spaceæ˜¯ç©ºçš„ï¼Œå¦ä¸€ä¸ªéç©ºçš„survivor spaceæ— ç¢ç‰‡**

â€‹	åˆšåˆšå¼€å§‹çš„æ—¶å€™ï¼Œ2ä¸ªSurvivoråŒºï¼Œå’ŒEdenåŒºéƒ½æ˜¯ç©ºçš„ã€‚æ…¢æ…¢çš„edenåŒºæ»¡äº†ï¼Œé‚£å°±æ˜¯ç¬¬ä¸€æ¬¡çš„æ“ä½œã€‚GCä¹‹åï¼ŒEdenåŒºä¼šè¢«æ¸…ç†å¹²å‡€ï¼Œæ´»ç€çš„å¯¹è±¡å°±ä¼šè¢«copyåˆ°ä¸€ä¸ªSurvivoråŒºï¼Œå‡è®¾ä¸ºS0ã€‚**å› ä¸ºæ˜¯ä»EdenåŒºå¤åˆ¶è¿‡æ¥çš„ï¼Œé‚£ä¹ˆè‚¯å®šåœ¨è¿™ä¸ªS0åŒºæ‘†æ”¾è¿™äº›å­˜æ´»å¯¹è±¡çš„æ—¶å€™ï¼Œè‚¯å®šæ˜¯æŒ¨ç€æ”¾çš„ï¼Œæ‰€ä»¥ï¼Œä½¿ç”¨çš„æ˜¯è¿ç»­ç©ºé—´ï¼Œæ‰€ä»¥ï¼Œæ˜¯æ²¡ç¢ç‰‡çš„ã€‚**

â€‹	ç„¶åEdenåˆç»§ç»­æ–°å¢å¯¹è±¡ï¼Œç›´åˆ°æœ€åè¿™ä¸ªEdenåˆæ»¡äº†ï¼Œè¿™ä¸ªæ—¶å€™ï¼ŒEdenå’ŒS0åŒºéƒ½æ˜¯æœ‰æ•°æ®çš„ï¼Œéç©ºçš„ã€‚ç„¶åGCä¹‹åï¼ŒEdenåŒºæœ‰å¹¸å­˜è€…ï¼ŒS0åŒºä¹Ÿè¢«å‡€åŒ–ä¹‹åï¼Œä¹Ÿæœ‰å¹¸å­˜è€…ï¼Œè¿™ä¸ªæ—¶å€™ï¼ŒS1æ˜¯emptyçš„ï¼Œç„¶åå°±æŠŠè¿™S0å’Œedenè¿™2åŒºçš„å¹¸å­˜è€…ç»™copyåˆ°S1åŒºï¼Œåœ¨å¤åˆ¶çš„æ—¶å€™ï¼ŒS1åŒºçš„ç©ºé—´ä¹Ÿæ˜¯æŒ¨ç€åˆ†é…åˆ°ä¹Ÿæ²¡ç¢ç‰‡ã€‚ç„¶åï¼Œemptyç½®ç©ºEdenåŒºå’ŒS0åŒºï¼Œè¿™å°±è§£é‡Šäº†ï¼šâ€œæ°¸è¿œæœ‰ä¸€ä¸ªsurvivor spaceæ˜¯ç©ºçš„ï¼Œå¦ä¸€ä¸ªéç©ºçš„survivor spaceæ— ç¢ç‰‡ã€‚ä¸ºä»€ä¹ˆå¦ä¸€ä¸ªéç©ºçš„æ— ç¢ç‰‡â€

å‚ç…§ [ã€Šä¸ºä»€ä¹ˆæ–°ç”Ÿä»£å†…å­˜éœ€è¦æœ‰ä¸¤ä¸ª Survivor åŒºã€‹](https://blog.csdn.net/qq_27093465/article/details/79802884) æ–‡ç« ã€‚

## 8ã€æ–°ç”Ÿä»£ GC å’Œè€å¹´ä»£ GC

â€‹	GC ç»å¸¸å‘ç”Ÿçš„åŒºåŸŸæ˜¯å †åŒºï¼Œå †åŒºè¿˜å¯ä»¥ç»†åˆ†ä¸º

![å †](/Users/jack/Desktop/md/images/67796f9fc657b7b4dd0054f561248f5b.png)

- æ–°ç”Ÿä»£
  - ä¸€ä¸ª Eden åŒº
  - ä¸¤ä¸ª Survivor åŒº
- è€å¹´ä»£

> é»˜è®¤æ–°ç”Ÿä»£(Young)ä¸è€å¹´ä»£(Old)çš„æ¯”ä¾‹çš„å€¼ä¸º `1:2` (è¯¥å€¼å¯ä»¥é€šè¿‡å‚æ•° `â€“XX:NewRatio` æ¥æŒ‡å®š)ã€‚
>
> é»˜è®¤çš„ `Eden:from:to=8:1:1` (å¯ä»¥é€šè¿‡å‚æ•° `â€“XX:SurvivorRatio` æ¥è®¾å®š)ã€‚

**æ–°ç”Ÿä»£GCï¼ˆMinorGC/YoungGCï¼‰**ï¼šæŒ‡å‘ç”Ÿåœ¨æ–°ç”Ÿä»£çš„åƒåœ¾æ”¶é›†åŠ¨ä½œï¼Œå› ä¸º Java å¯¹è±¡å¤§å¤šéƒ½å…·å¤‡æœç”Ÿå¤•ç­çš„ç‰¹æ€§ï¼Œæ‰€ä»¥ MinorGC éå¸¸é¢‘ç¹ï¼Œä¸€èˆ¬å›æ”¶é€Ÿåº¦ä¹Ÿæ¯”è¾ƒå¿«ã€‚

**è€å¹´ä»£GCï¼ˆMajorGC/FullGCï¼‰**ï¼šæŒ‡å‘ç”Ÿåœ¨è€å¹´ä»£çš„ GCï¼Œå‡ºç°äº† MajorGCï¼Œç»å¸¸ä¼šä¼´éšè‡³å°‘ä¸€æ¬¡çš„ MinorGCï¼ˆä½†éç»å¯¹çš„ï¼Œåœ¨ Parallel Scavenge æ”¶é›†å™¨çš„æ”¶é›†ç­–ç•¥é‡Œå°±æœ‰ç›´æ¥è¿›è¡Œ MajorGC çš„ç­–ç•¥é€‰æ‹©è¿‡ç¨‹ï¼‰ã€‚MajorGC çš„é€Ÿåº¦ä¸€èˆ¬ä¼šæ¯” MinorGC æ…¢ 10 å€ä»¥ä¸Šã€‚

###  **ä»€ä¹ˆæƒ…å†µä¸‹ä¼šå‡ºç° Young GCï¼Ÿ**

â€‹	å¯¹è±¡ä¼˜å…ˆåœ¨æ–°ç”Ÿä»£ Eden åŒºä¸­åˆ†é…ï¼Œå¦‚æœ Eden åŒºæ²¡æœ‰è¶³å¤Ÿçš„ç©ºé—´æ—¶ï¼Œå°±ä¼šè§¦å‘ä¸€æ¬¡ Young GC ã€‚

###  **ä»€ä¹ˆæƒ…å†µä¸‹å›å‡ºç° Full GCï¼Ÿ**

â€‹	**Full GC çš„è§¦å‘æ¡ä»¶æœ‰å¤šä¸ªï¼ŒFULL GC çš„æ—¶å€™ä¼š STOP THE WORD ã€‚**

- 1ã€åœ¨æ‰§è¡Œ Young GC ä¹‹å‰ï¼ŒJVM ä¼šè¿›è¡Œç©ºé—´åˆ†é…æ‹…ä¿â€”â€”**å¦‚æœè€å¹´ä»£çš„è¿ç»­ç©ºé—´å°äºæ–°ç”Ÿä»£å¯¹è±¡çš„æ€»å¤§å°ï¼ˆæˆ–å†æ¬¡æ™‹å‡çš„å¹³å‡å¤§å°ï¼‰ï¼Œåˆ™è§¦å‘ä¸€æ¬¡ Full GC ã€‚**
- 2ã€å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£ï¼Œä»å¹´è½»ä»£æ™‹å‡ä¸Šæ¥çš„è€å¯¹è±¡ï¼Œå°è¯•åœ¨è€å¹´ä»£åˆ†é…å†…å­˜æ—¶ï¼Œä½†æ˜¯è€å¹´ä»£å†…å­˜ç©ºé—´ä¸å¤Ÿã€‚
- 3ã€æ˜¾å¼è°ƒç”¨ `System.gc()` æ–¹æ³•æ—¶ã€‚

# ä¹ã€è™šæ‹Ÿæœºæ€§èƒ½ç›‘æ§ä¸æ•…éšœå¤„ç†å·¥å…·

## 1.JDKç›‘æ§è™šæ‹Ÿæœºçš„å‘½ä»¤è¡Œ

- jps ï¼šè™šæ‹Ÿæœºè¿›ç¨‹çŠ¶å†µå·¥å…·

  > JVM Process Status Tool ï¼Œæ˜¾ç¤ºæŒ‡å®šç³»ç»Ÿå†…æ‰€æœ‰çš„HotSpotè™šæ‹Ÿæœºè¿›ç¨‹ã€‚

- jstat ï¼šè™šæ‹Ÿæœºç»Ÿè®¡ä¿¡æ¯ç›‘æ§å·¥å…·

  > JVM statistics Monitoring ï¼Œæ˜¯ç”¨äºç›‘è§†è™šæ‹Ÿæœºè¿è¡Œæ—¶çŠ¶æ€ä¿¡æ¯çš„å‘½ä»¤ï¼Œå®ƒå¯ä»¥æ˜¾ç¤ºå‡ºè™šæ‹Ÿæœºè¿›ç¨‹ä¸­çš„ç±»è£…è½½ã€å†…å­˜ã€åƒåœ¾æ”¶é›†ã€JITç¼–è¯‘ç­‰è¿è¡Œæ•°æ®ã€‚

- jinfo ï¼šJava é…ç½®ä¿¡æ¯å·¥å…·

  > JVM Configuration info ï¼Œè¿™ä¸ªå‘½ä»¤ä½œç”¨æ˜¯å®æ—¶æŸ¥çœ‹å’Œè°ƒæ•´è™šæ‹Ÿæœºè¿è¡Œå‚æ•°ã€‚

- jmap ï¼šJava å†…å­˜æ˜ å°„å·¥å…·

  > JVM Memory Map ï¼Œå‘½ä»¤ç”¨äºç”Ÿæˆ heap dump æ–‡ä»¶ã€‚

- jhat ï¼šè™šæ‹Ÿæœºå †è½¬å‚¨å¿«ç…§åˆ†æå·¥å…·

  > JVM Heap Analysis Tool ï¼Œå‘½ä»¤æ˜¯ä¸ jmap æ­é…ä½¿ç”¨ï¼Œç”¨æ¥åˆ†æ jmap ç”Ÿæˆçš„ dump æ–‡ä»¶ã€‚jhat å†…ç½®äº†ä¸€ä¸ªå¾®å‹ çš„HTTP/HTML æœåŠ¡å™¨ï¼Œç”Ÿæˆ dump çš„åˆ†æç»“æœåï¼Œå¯ä»¥åœ¨æµè§ˆå™¨ä¸­æŸ¥çœ‹ã€‚

- jstack ï¼šJava å †æ ˆè·Ÿè¸ªå·¥å…·

  > Java Stack Trace ï¼Œç”¨äºç”Ÿæˆ Java è™šæ‹Ÿæœºå½“å‰æ—¶åˆ»çš„çº¿ç¨‹å¿«ç…§ã€‚

- HSDIS ï¼šJIT ç”Ÿæˆä»£ç åç¼–è¯‘

## 2.JDKç›‘æ§è™šæ‹Ÿæœºçš„å¯è§†åŒ–å·¥å…·

- Java è‡ªå¸¦

  - JConsole ï¼šJava ç›‘è§†ä¸ç®¡ç†æ§åˆ¶å°

    > Java Monitoring and Management Console æ˜¯ä» Java5 å¼€å§‹ï¼Œåœ¨ JDK ä¸­è‡ªå¸¦çš„ Java ç›‘æ§å’Œç®¡ç†æ§åˆ¶å°ï¼Œç”¨äºå¯¹ JVM ä¸­å†…å­˜ï¼Œçº¿ç¨‹å’Œç±»ç­‰çš„ç›‘æ§ã€‚

  - [VisualVM](https://blog.csdn.net/a19881029/article/details/8432368/) ï¼šå¤šåˆä¸€æ•…éšœå¤„ç†å·¥å…·

    > JDK è‡ªå¸¦å…¨èƒ½å·¥å…·ï¼Œå¯ä»¥åˆ†æå†…å­˜å¿«ç…§ã€çº¿ç¨‹å¿«ç…§ã€ç›‘æ§å†…å­˜å˜åŒ–ã€GCå˜åŒ–ç­‰ã€‚
    >
    > ç‰¹åˆ«æ˜¯ BTrace æ’ä»¶ï¼ŒåŠ¨æ€è·Ÿè¸ªåˆ†æå·¥å…·ã€‚

- ç¬¬ä¸‰æ–¹

  - MAT ï¼šå†…å­˜åˆ†æå·¥å…·

    > Memory Analyzer Tool ï¼Œä¸€ä¸ªåŸºäº Eclipse çš„å†…å­˜åˆ†æå·¥å…·ï¼Œæ˜¯ä¸€ä¸ªå¿«é€Ÿã€åŠŸèƒ½ä¸°å¯Œçš„ Java heap åˆ†æå·¥å…·ï¼Œå®ƒå¯ä»¥å¸®åŠ©æˆ‘ä»¬æŸ¥æ‰¾å†…å­˜æ³„æ¼å’Œå‡å°‘å†…å­˜æ¶ˆè€—ã€‚

  - [GChisto](http://svip.iocoder.cn/Java/VirtualMachine/Interview/GC%20%E6%97%A5%E5%BF%97%E5%88%86%E6%9E%90%E5%B7%A5%E5%85%B7%20%E2%80%94%E2%80%94%20GChisto) ï¼šä¸€æ¬¾ä¸“ä¸šåˆ†æ GC æ—¥å¿—çš„å·¥å…·ã€‚

å¦å¤–ï¼Œä¸€äº›å¼€æºé¡¹ç›®ï¼Œä¾‹å¦‚ [SkyWalking](https://github.com/apache/incubator-skywalking)ã€[Cat](https://github.com/dianping/cat) ï¼Œä¹Ÿæä¾›äº† JVM ç›‘æ§çš„åŠŸèƒ½ï¼Œæ›´åŠ é€‚åˆç”Ÿäº§ç¯å¢ƒï¼Œå¯¹ JVM çš„ç›‘æ§ã€‚

## 3.è·å– Java ç¨‹åºä½¿ç”¨çš„å†…å­˜

â€‹	å¯ä»¥é€šè¿‡ `java.lang.Runtime` ç±»ä¸­ä¸å†…å­˜ç›¸å…³æ–¹æ³•æ¥è·å–å‰©ä½™çš„å†…å­˜ï¼Œæ€»å†…å­˜åŠæœ€å¤§å †å†…å­˜ã€‚é€š**è¿‡è¿™äº›æ–¹æ³•ä½ ä¹Ÿå¯ä»¥è·å–åˆ°å †ä½¿ç”¨çš„ç™¾åˆ†æ¯”åŠå †å†…å­˜çš„å‰©ä½™ç©ºé—´ã€‚**

- `Runtime.freeMemory()` æ–¹æ³•ï¼Œè¿”å›å‰©ä½™ç©ºé—´çš„å­—èŠ‚æ•°ã€‚
- `Runtime.totalMemory()` æ–¹æ³•ï¼Œæ€»å†…å­˜çš„å­—èŠ‚æ•°ã€‚
- `Runtime.maxMemory()` æ–¹æ³•ï¼Œè¿”å›æœ€å¤§å†…å­˜çš„å­—èŠ‚æ•°ã€‚

# åã€GC çš„ä¼˜åŒ–é…ç½®

| é…ç½®              | æè¿°                                     |
| ----------------- | ---------------------------------------- |
| -Xms              | åˆå§‹åŒ–å †å†…å­˜å¤§å°                         |
| -Xmx              | å †å†…å­˜æœ€å¤§å€¼                             |
| -Xmn              | æ–°ç”Ÿä»£å¤§å°                               |
| -XX:PermSize      | åˆå§‹åŒ–æ°¸ä¹…ä»£å¤§å°                         |
| -XX:MaxPermSize   | æ°¸ä¹…ä»£æœ€å¤§å®¹é‡                           |
| -XX:SurvivorRatio | è®¾ç½®å¹´è½»ä»£ä¸­ Eden åŒºä¸ Survivor åŒºçš„æ¯”å€¼ |
| -XX:Xmn           | è®¾ç½®å¹´è½»ä»£å¤§å°                           |

å¦å¤–ï¼Œä¹Ÿå¯ä»¥çœ‹çœ‹ [ã€ŠJVM è°ƒä¼˜ã€‹](https://blog.csdn.net/zhaojw_420/article/details/70527138) æ–‡ç« ã€‚

# åä¸€ã€æ’æŸ¥çº¿ç¨‹ Full GC é¢‘ç¹çš„é—®é¢˜

- [ã€Šçº¿ä¸Š Full GC é¢‘ç¹çš„æ’æŸ¥ã€‹](https://blog.csdn.net/wilsonpeng3/article/details/70064336/)
- [ã€Šè§¦å‘ JVM è¿›è¡Œ Full GC çš„æƒ…å†µåŠåº”å¯¹ç­–ç•¥ã€‹](https://blog.csdn.net/chenleixing/article/details/46706039/)

ğŸ¦… **JVM çš„æ°¸ä¹…ä»£ä¸­ä¼šå‘ç”Ÿåƒåœ¾å›æ”¶ä¹ˆï¼Ÿ**

- **Young GC** ä¸ä¼šå‘ç”Ÿåœ¨æ°¸ä¹…ä»£ã€‚

- ==å¦‚æœæ°¸ä¹…ä»£æ»¡äº†æˆ–è€…æ˜¯è¶…è¿‡äº†ä¸´ç•Œå€¼ï¼Œä¼šè§¦å‘å®Œå…¨åƒåœ¾å›æ”¶(**Full GC**)ã€‚==å¦‚æœæˆ‘ä»¬ä»”ç»†æŸ¥çœ‹åƒåœ¾æ”¶é›†å™¨çš„è¾“å‡ºä¿¡æ¯ï¼Œå°±ä¼šå‘ç°æ°¸ä¹…ä»£ä¹Ÿæ˜¯è¢«å›æ”¶çš„ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆæ­£ç¡®çš„æ°¸ä¹…ä»£å¤§å°å¯¹é¿å… Full GC æ˜¯éå¸¸é‡è¦çš„åŸå› ã€‚

  > Java8 ï¼šä»æ°¸ä¹…ä»£åˆ°å…ƒæ•°æ®åŒº (æ³¨ï¼šJava8 ä¸­å·²ç»ç§»é™¤äº†æ°¸ä¹…ä»£ï¼Œæ–°åŠ äº†ä¸€ä¸ªå«åšå…ƒæ•°æ®åŒºçš„ native å†…å­˜åŒº)ã€‚

# åäºŒã€GC æ—¥å¿—

å‚è§æ–‡ç« å¦‚ä¸‹ï¼š

- [ã€Š[JVM\]ç†è§£GCæ—¥å¿—ã€‹](https://www.jianshu.com/p/fd1d4f21733a)
- [ã€ŠGC æ—¥å¿—æŸ¥çœ‹åˆ†æã€‹](https://blog.csdn.net/TimHeath/article/details/53053106)







































